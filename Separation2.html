<!DOCTYPE html>
<html class="alectryon-standalone"><head><title>Separation2.v</title><meta charset="utf-8"><meta content="Alectryon" name="generator"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="alectryon.css" rel="stylesheet"><link href="pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" /><script src="alectryon.js"></script></head><body><article class="alectryon-root alectryon-centered alectryon-coqdoc"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.19.0+0.19.3. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+‚Üë</kbd> <kbd>Ctrl+‚Üì</kbd> to navigate, <kbd>Ctrl+üñ±Ô∏è</kbd> to focus. On Mac, use <kbd>‚åò</kbd> instead of <kbd>Ctrl</kbd>.</div><div class="doc">
Heaps and heap assertions for separation logics. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk0"><span class="kn">From</span> Coq <span class="kn">Require Import</span> ZArith Lia Bool String List.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">[Loading ML file ring_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file zify_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file micromega_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file btauto_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> Coq <span class="kn">Require Import</span> FunctionalExtensionality PropExtensionality.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> CDF <span class="kn">Require Import</span> Common.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Local</span> <span class="kn">Open Scope</span> Z_scope.</span></span></pre><div class="doc">
<a id="lab1"></a><h1 class="section">1. Memory heaps</h1>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
A memory heap is a partial function from addresses (memory locations) 
    to values, with a finite domain. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">addr</span> := Z.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Record</span> <span class="nf">heap</span> : <span class="kt">Type</span> := {
  contents :&gt; addr -&gt; option Z;
  isfinite :  <span class="kr">exists</span> <span class="nv">i</span>, <span class="kr">forall</span> <span class="nv">j</span>, i &lt;= j -&gt; contents j = None
}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk1"><span class="kn">Lemma</span> <span class="nf">heap_extensionality</span>:
  <span class="kr">forall</span> (<span class="nv">h1</span> <span class="nv">h2</span>: heap),
  (<span class="kr">forall</span> <span class="nv">l</span>, h1 l = h2 l) -&gt; h1 = h2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = h2 l) -&gt; h1 = h2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = h2 l) -&gt; h1 = h2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk3"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = h2 l</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h1 = h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk4"><span class="nb">destruct</span> h1 <span class="kr">as</span> [c1 fin1], h2 <span class="kr">as</span> [c2 fin2].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c1</var><span class="hyp-type"><b>: </b><span>addr -&gt; option Z</span></span></span><br><span><var>fin1</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; c1 j = None</span></span></span><br><span><var>c2</var><span class="hyp-type"><b>: </b><span>addr -&gt; option Z</span></span></span><br><span><var>fin2</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; c2 j = None</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr,
{| contents := c1; isfinite := fin1 |} l =
{| contents := c2; isfinite := fin2 |} l</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{| contents := c1; isfinite := fin1 |} =
{| contents := c2; isfinite := fin2 |}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk5"><span class="nb">assert</span> (c1 = c2) <span class="bp">by</span> (<span class="nb">apply</span> functional_extensionality; <span class="nb">auto</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c1</var><span class="hyp-type"><b>: </b><span>addr -&gt; option Z</span></span></span><br><span><var>fin1</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; c1 j = None</span></span></span><br><span><var>c2</var><span class="hyp-type"><b>: </b><span>addr -&gt; option Z</span></span></span><br><span><var>fin2</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; c2 j = None</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr,
{| contents := c1; isfinite := fin1 |} l =
{| contents := c2; isfinite := fin2 |} l</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>c1 = c2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{| contents := c1; isfinite := fin1 |} =
{| contents := c2; isfinite := fin2 |}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk6"><span class="nb">subst</span> c2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c1</var><span class="hyp-type"><b>: </b><span>addr -&gt; option Z</span></span></span><br><span><var>fin1, fin2</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; c1 j = None</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr,
{| contents := c1; isfinite := fin1 |} l =
{| contents := c1; isfinite := fin2 |} l</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">{| contents := c1; isfinite := fin1 |} =
{| contents := c1; isfinite := fin2 |}</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk7"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>c1</var><span class="hyp-type"><b>: </b><span>addr -&gt; option Z</span></span></span><br><span><var>fin1, fin2</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; c1 j = None</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr,
{| contents := c1; isfinite := fin1 |} l =
{| contents := c1; isfinite := fin2 |} l</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">fin1 = fin2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> proof_irrelevance.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
The empty heap. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Program Definition</span> <span class="nf">hempty</span> : heap :=
  {| contents := <span class="kr">fun</span> <span class="nv">l</span> =&gt; None |}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk8"><span class="kn">Next Obligation</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i</span> : Z, <span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; None = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="mi">0</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
The heap that contains <span class="inlinecode"><span class="id" title="var">v</span></span> at address <span class="inlinecode"><span class="id" title="var">l</span></span> and is equal to <span class="inlinecode"><span class="id" title="var">h</span></span> on
    all other addresses. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Program Definition</span> <span class="nf">hupdate</span> (<span class="nv">l</span>: addr) (<span class="nv">v</span>: Z) (<span class="nv">h</span>: heap) : heap :=
  {| contents := <span class="kr">fun</span> <span class="nv">l&#39;</span> =&gt; <span class="kr">if</span> Z.eq_dec l l&#39; <span class="kr">then</span> Some v <span class="kr">else</span> h l&#39; |}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk9"><span class="kn">Next Obligation</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z,
  i &lt;= j -&gt;
  (<span class="kr">if</span> Z.eq_dec l j <span class="kr">then</span> Some v <span class="kr">else</span> h j) = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka"><span class="nb">destruct</span> (isfinite h) <span class="kr">as</span> (i &amp; fin).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; h j = None</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z,
  i &lt;= j -&gt;
  (<span class="kr">if</span> Z.eq_dec l j <span class="kr">then</span> Some v <span class="kr">else</span> h j) = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb"><span class="kr">exists</span> (<span class="nv">Z</span>.max i (l + <span class="mi">1</span>)); <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; h j = None</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Z.max i (l + <span class="mi">1</span>) &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> Z.eq_dec l j <span class="kr">then</span> Some v <span class="kr">else</span> h j) = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkc"><span class="nb">destruct</span> (Z.eq_dec l j).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; h j = None</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Z.max i (l + <span class="mi">1</span>) &lt;= j</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>l = j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some v = None</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chkd" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; h j = None</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Z.max i (l + <span class="mi">1</span>) &lt;= j</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>l &lt;&gt; j</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chkd"><hr></label><div class="goal-conclusion">h j = None</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke"><span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; h j = None</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Z.max i (l + <span class="mi">1</span>) &lt;= j</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>l &lt;&gt; j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h j = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> fin; <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf"><span class="kn">Lemma</span> <span class="nf">hupdate_same</span>: <span class="kr">forall</span> <span class="nv">l</span> <span class="nv">v</span> <span class="nv">h</span>, (hupdate l v h) l = Some v.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">l</span> : addr) (<span class="nv">v</span> : Z) (<span class="nv">h</span> : heap),
hupdate l v h l = Some v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk10" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk10"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">l</span> : addr) (<span class="nv">v</span> : Z) (<span class="nv">h</span> : heap),
hupdate l v h l = Some v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk11"><span class="nb">intros</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> Z.eq_dec l l <span class="kr">then</span> Some v <span class="kr">else</span> h l) = Some v</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> (Z.eq_dec l l); <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk12"><span class="kn">Lemma</span> <span class="nf">hupdate_other</span>: <span class="kr">forall</span> <span class="nv">l</span> <span class="nv">v</span> <span class="nv">h</span> <span class="nv">l&#39;</span>, l &lt;&gt; l&#39; -&gt; (hupdate l v h) l&#39; = h l&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">l</span> : addr) (<span class="nv">v</span> : Z) (<span class="nv">h</span> : heap) (<span class="nv">l&#39;</span> : addr),
l &lt;&gt; l&#39; -&gt; hupdate l v h l&#39; = h l&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk13"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">l</span> : addr) (<span class="nv">v</span> : Z) (<span class="nv">h</span> : heap) (<span class="nv">l&#39;</span> : addr),
l &lt;&gt; l&#39; -&gt; hupdate l v h l&#39; = h l&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk14"><span class="nb">intros</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l'</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l &lt;&gt; l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> Z.eq_dec l l&#39; <span class="kr">then</span> Some v <span class="kr">else</span> h l&#39;) = h l&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> (Z.eq_dec l l&#39;); <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">hsingle</span> (<span class="nv">l</span>: addr) (<span class="nv">v</span>: Z) : heap :=
  hupdate l v hempty.</span></span></pre><div class="doc">
The heap <span class="inlinecode"><span class="id" title="var">h</span></span> after deallocating address <span class="inlinecode"><span class="id" title="var">l</span></span>. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Program Definition</span> <span class="nf">hfree</span> (<span class="nv">l</span>: addr) (<span class="nv">h</span>: heap) : heap :=
  {| contents := <span class="kr">fun</span> <span class="nv">l&#39;</span> =&gt; <span class="kr">if</span> Z.eq_dec l l&#39; <span class="kr">then</span> None <span class="kr">else</span> h l&#39; |}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk15"><span class="kn">Next Obligation</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z,
  i &lt;= j -&gt;
  (<span class="kr">if</span> Z.eq_dec l j <span class="kr">then</span> None <span class="kr">else</span> h j) = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk16"><span class="nb">destruct</span> (isfinite h) <span class="kr">as</span> (i &amp; fin).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; h j = None</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z,
  i &lt;= j -&gt;
  (<span class="kr">if</span> Z.eq_dec l j <span class="kr">then</span> None <span class="kr">else</span> h j) = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk17"><span class="kr">exists</span> <span class="nv">i</span>; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i &lt;= j -&gt; h j = None</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>i &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> Z.eq_dec l j <span class="kr">then</span> None <span class="kr">else</span> h j) = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> (Z.eq_dec l j); <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
The heap <span class="inlinecode"><span class="id" title="var">h</span></span> where addresses <span class="inlinecode"><span class="id" title="var">l</span>,</span> <span class="inlinecode">...,</span> <span class="inlinecode"><span class="id" title="var">l</span></span> <span class="inlinecode">+</span> <span class="inlinecode"><span class="id" title="var">sz</span></span> <span class="inlinecode">-</span> <span class="inlinecode">1</span> are initialized to 0. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Fixpoint</span> <span class="nf">hinit</span> (<span class="nv">l</span>: addr) (<span class="nv">sz</span>: nat) (<span class="nv">h</span>: heap) : heap :=
  <span class="kr">match</span> sz <span class="kr">with</span> O =&gt; h | S sz =&gt; hupdate l <span class="mi">0</span> (hinit (l + <span class="mi">1</span>) sz h) <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk18"><span class="kn">Lemma</span> <span class="nf">hinit_inside</span>:
  <span class="kr">forall</span> <span class="nv">h</span> <span class="nv">sz</span> <span class="nv">l</span> <span class="nv">l&#39;</span>, l &lt;= l&#39; &lt; l + Z.of_nat sz -&gt; hinit l sz h l&#39; = Some <span class="mi">0</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">h</span> : heap) (<span class="nv">sz</span> : nat) (<span class="nv">l</span> <span class="nv">l&#39;</span> : Z),
l &lt;= l&#39; &lt; l + Z.of_nat sz -&gt; hinit l sz h l&#39; = Some <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk19"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">h</span> : heap) (<span class="nv">sz</span> : nat) (<span class="nv">l</span> <span class="nv">l&#39;</span> : Z),
l &lt;= l&#39; &lt; l + Z.of_nat sz -&gt; hinit l sz h l&#39; = Some <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk1a"><span class="nb">induction</span> sz; <span class="nb">intros</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l &lt;= l&#39; &lt; l + Z.of_nat <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h l&#39; = Some <span class="mi">0</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk1b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sz</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHsz</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> <span class="nv">l&#39;</span> : Z,
l &lt;= l&#39; &lt; l + Z.of_nat sz -&gt;
hinit l sz h l&#39; = Some <span class="mi">0</span></span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l &lt;= l&#39; &lt; l + Z.of_nat (S sz)</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk1b"><hr></label><div class="goal-conclusion">(<span class="kr">if</span> Z.eq_dec l l&#39;
 <span class="kr">then</span> Some <span class="mi">0</span>
 <span class="kr">else</span> hinit (l + <span class="mi">1</span>) sz h l&#39;) = Some <span class="mi">0</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk1c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk1c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l &lt;= l&#39; &lt; l + Z.of_nat <span class="mi">0</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h l&#39; = Some <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk1d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk1d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sz</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHsz</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> <span class="nv">l&#39;</span> : Z,
l &lt;= l&#39; &lt; l + Z.of_nat sz -&gt;
hinit l sz h l&#39; = Some <span class="mi">0</span></span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l &lt;= l&#39; &lt; l + Z.of_nat (S sz)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> Z.eq_dec l l&#39;
 <span class="kr">then</span> Some <span class="mi">0</span>
 <span class="kr">else</span> hinit (l + <span class="mi">1</span>) sz h l&#39;) = Some <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk1e"><span class="nb">destruct</span> (Z.eq_dec l l&#39;); <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sz</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHsz</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> <span class="nv">l&#39;</span> : Z,
l &lt;= l&#39; &lt; l + Z.of_nat sz -&gt;
hinit l sz h l&#39; = Some <span class="mi">0</span></span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l &lt;= l&#39; &lt; l + Z.of_nat (S sz)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>l &lt;&gt; l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hinit (l + <span class="mi">1</span>) sz h l&#39; = Some <span class="mi">0</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk1f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk1f"><span class="nb">apply</span> IHsz.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sz</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHsz</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> <span class="nv">l&#39;</span> : Z,
l &lt;= l&#39; &lt; l + Z.of_nat sz -&gt;
hinit l sz h l&#39; = Some <span class="mi">0</span></span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l &lt;= l&#39; &lt; l + Z.of_nat (S sz)</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>l &lt;&gt; l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">l + <span class="mi">1</span> &lt;= l&#39; &lt; l + <span class="mi">1</span> + Z.of_nat sz</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk20"><span class="kn">Lemma</span> <span class="nf">hinit_outside</span>:
  <span class="kr">forall</span> <span class="nv">h</span> <span class="nv">sz</span> <span class="nv">l</span> <span class="nv">l&#39;</span>, l&#39; &lt; l \/ l + Z.of_nat sz &lt;= l&#39; -&gt; hinit l sz h l&#39; = h l&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">h</span> : heap) (<span class="nv">sz</span> : nat) (<span class="nv">l</span> <span class="nv">l&#39;</span> : Z),
l&#39; &lt; l \/ l + Z.of_nat sz &lt;= l&#39; -&gt;
hinit l sz h l&#39; = h l&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk21"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">h</span> : heap) (<span class="nv">sz</span> : nat) (<span class="nv">l</span> <span class="nv">l&#39;</span> : Z),
l&#39; &lt; l \/ l + Z.of_nat sz &lt;= l&#39; -&gt;
hinit l sz h l&#39; = h l&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk22"><span class="nb">induction</span> sz; <span class="nb">intros</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l&#39; &lt; l \/ l + Z.of_nat <span class="mi">0</span> &lt;= l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h l&#39; = h l&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk23" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sz</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHsz</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> <span class="nv">l&#39;</span> : Z,
l&#39; &lt; l \/ l + Z.of_nat sz &lt;= l&#39; -&gt;
hinit l sz h l&#39; = h l&#39;</span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l&#39; &lt; l \/ l + Z.of_nat (S sz) &lt;= l&#39;</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk23"><hr></label><div class="goal-conclusion">(<span class="kr">if</span> Z.eq_dec l l&#39;
 <span class="kr">then</span> Some <span class="mi">0</span>
 <span class="kr">else</span> hinit (l + <span class="mi">1</span>) sz h l&#39;) = h l&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk24" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk24">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l&#39; &lt; l \/ l + Z.of_nat <span class="mi">0</span> &lt;= l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h l&#39; = h l&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk25" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk25">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sz</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHsz</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> <span class="nv">l&#39;</span> : Z,
l&#39; &lt; l \/ l + Z.of_nat sz &lt;= l&#39; -&gt;
hinit l sz h l&#39; = h l&#39;</span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l&#39; &lt; l \/ l + Z.of_nat (S sz) &lt;= l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> Z.eq_dec l l&#39;
 <span class="kr">then</span> Some <span class="mi">0</span>
 <span class="kr">else</span> hinit (l + <span class="mi">1</span>) sz h l&#39;) = h l&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk26"><span class="nb">destruct</span> (Z.eq_dec l l&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sz</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHsz</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> <span class="nv">l&#39;</span> : Z,
l&#39; &lt; l \/ l + Z.of_nat sz &lt;= l&#39; -&gt;
hinit l sz h l&#39; = h l&#39;</span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l&#39; &lt; l \/ l + Z.of_nat (S sz) &lt;= l&#39;</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>l = l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some <span class="mi">0</span> = h l&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk27" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sz</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHsz</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> <span class="nv">l&#39;</span> : Z,
l&#39; &lt; l \/ l + Z.of_nat sz &lt;= l&#39; -&gt;
hinit l sz h l&#39; = h l&#39;</span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l&#39; &lt; l \/ l + Z.of_nat (S sz) &lt;= l&#39;</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>l &lt;&gt; l&#39;</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk27"><hr></label><div class="goal-conclusion">hinit (l + <span class="mi">1</span>) sz h l&#39; = h l&#39;</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk28"><span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sz</var><span class="hyp-type"><b>: </b><span>nat</span></span></span><br><span><var>IHsz</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> <span class="nv">l&#39;</span> : Z,
l&#39; &lt; l \/ l + Z.of_nat sz &lt;= l&#39; -&gt;
hinit l sz h l&#39; = h l&#39;</span></span></span><br><span><var>l, l'</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>l&#39; &lt; l \/ l + Z.of_nat (S sz) &lt;= l&#39;</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>l &lt;&gt; l&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hinit (l + <span class="mi">1</span>) sz h l&#39; = h l&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> IHsz; <span class="bp">lia</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
The disjoint union of two heaps. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">hdisjoint</span> (<span class="nv">h1</span> <span class="nv">h2</span>: heap) : <span class="kt">Prop</span> :=
  <span class="kr">forall</span> <span class="nv">l</span>, h1 l = None \/ h2 l = None.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk29" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk29"><span class="kn">Lemma</span> <span class="nf">hdisjoint_sym</span>:
  <span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span>, hdisjoint h1 h2 &lt;-&gt; hdisjoint h2 h1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
hdisjoint h1 h2 &lt;-&gt; hdisjoint h2 h1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk2a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk2a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
hdisjoint h1 h2 &lt;-&gt; hdisjoint h2 h1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">unfold</span> hdisjoint; <span class="nb">intros</span>; <span class="nb">split</span>; <span class="nb">intros</span> H l; <span class="nb">specialize</span> (H l); <span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Program Definition</span> <span class="nf">hunion</span> (<span class="nv">h1</span> <span class="nv">h2</span>: heap) : heap :=
  {| contents := <span class="kr">fun</span> <span class="nv">l</span> =&gt; <span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l |}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk2b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk2b"><span class="kn">Next Obligation</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z,
  i &lt;= j -&gt; (<span class="kr">if</span> h1 j <span class="kr">then</span> h1 j <span class="kr">else</span> h2 j) = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk2c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk2c"><span class="nb">destruct</span> (isfinite h1) <span class="kr">as</span> (i1 &amp; fin1), (isfinite h2) <span class="kr">as</span> (i2 &amp; fin2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i1 &lt;= j -&gt; h1 j = None</span></span></span><br><span><var>i2</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i2 &lt;= j -&gt; h2 j = None</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">i</span> : Z,
  <span class="kr">forall</span> <span class="nv">j</span> : Z,
  i &lt;= j -&gt; (<span class="kr">if</span> h1 j <span class="kr">then</span> h1 j <span class="kr">else</span> h2 j) = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk2d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk2d"><span class="kr">exists</span> (<span class="nv">Z</span>.max i1 i2); <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i1 &lt;= j -&gt; h1 j = None</span></span></span><br><span><var>i2</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i2 &lt;= j -&gt; h2 j = None</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Z.max i1 i2 &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> h1 j <span class="kr">then</span> h1 j <span class="kr">else</span> h2 j) = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk2e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk2e"><span class="nb">rewrite</span> fin1, fin2 <span class="bp">by</span> <span class="bp">lia</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>i1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i1 &lt;= j -&gt; h1 j = None</span></span></span><br><span><var>i2</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>fin2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">j</span> : Z, i2 &lt;= j -&gt; h2 j = None</span></span></span><br><span><var>j</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Z.max i1 i2 &lt;= j</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">None = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk2f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk2f"><span class="kn">Lemma</span> <span class="nf">hunion_comm</span>:
  <span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span>, hdisjoint h1 h2 -&gt; hunion h2 h1 = hunion h1 h2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
hdisjoint h1 h2 -&gt; hunion h2 h1 = hunion h1 h2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk30" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk30"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
hdisjoint h1 h2 -&gt; hunion h2 h1 = hunion h1 h2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk31" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk31"><span class="nb">intros</span>; <span class="nb">apply</span> heap_extensionality; <span class="nb">intros</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> h2 l <span class="kr">then</span> h2 l <span class="kr">else</span> h1 l) =
(<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk32" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk32"><span class="nb">specialize</span> (H l).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>h1 l = None \/ h2 l = None</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> h2 l <span class="kr">then</span> h2 l <span class="kr">else</span> h1 l) =
(<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> (h1 l), (h2 l); <span class="nb">intuition</span> <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk33" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk33"><span class="kn">Lemma</span> <span class="nf">hunion_assoc</span>:
  <span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span>, hunion (hunion h1 h2) h3 = hunion h1 (hunion h2 h3).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span> : heap,
hunion (hunion h1 h2) h3 = hunion h1 (hunion h2 h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk34" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk34"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span> : heap,
hunion (hunion h1 h2) h3 = hunion h1 (hunion h2 h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk35" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk35"><span class="nb">intros</span>; <span class="nb">apply</span> heap_extensionality; <span class="nb">intros</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> <span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l
 <span class="kr">then</span> <span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l
 <span class="kr">else</span> h3 l) =
(<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> <span class="kr">if</span> h2 l <span class="kr">then</span> h2 l <span class="kr">else</span> h3 l)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> (h1 l); <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk36" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk36"><span class="kn">Lemma</span> <span class="nf">hunion_empty</span>:
  <span class="kr">forall</span> <span class="nv">h</span>, hunion hempty h = h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h</span> : heap, hunion hempty h = h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk37" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk37"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h</span> : heap, hunion hempty h = h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk38" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk38"><span class="nb">intros</span>; <span class="nb">apply</span> heap_extensionality; <span class="nb">intros</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h l = h l</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk39" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk39"><span class="kn">Lemma</span> <span class="nf">hunion_refl</span>:
  <span class="kr">forall</span> <span class="nv">h</span>, hunion h h = h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h</span> : heap, hunion h h = h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk3a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk3a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h</span> : heap, hunion h h = h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk3b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk3b"><span class="nb">intros</span>; <span class="nb">apply</span> heap_extensionality; <span class="nb">intros</span>; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> h l <span class="kr">then</span> h l <span class="kr">else</span> h l) = h l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> (h l); <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Lemma hfree_hunion_hupdate:</span>
<span class="c">  forall h l v,</span>
<span class="c">  hdisjoint (hupdate l v hempty) h -&gt;</span>
<span class="c">  hfree l (hunion (hupdate l v hempty) h) = h.</span>
<span class="c">Proof.</span>
<span class="c">  intros; apply heap_extensionality; intros; cbn.</span>
<span class="c">  (* l is the location that is not in h *)</span>
<span class="c">  (* l0 is an arb location *)</span>
<span class="c">  destruct (Z.eq_dec l l0).</span>
<span class="c">  - (* suppose l0 is the location that is not in h.</span>
<span class="c">      use disjointness to show l0/l is not in h *)</span>
<span class="c">    subst.</span>
<span class="c">    unfold hdisjoint in H.</span>
<span class="c">    pose proof (H l0) as H0; destruct H0.</span>
<span class="c">    + rewrite hupdate_same in H0.</span>
<span class="c">      discriminate H0.</span>
<span class="c">    + auto.</span>
<span class="c">  - destruct (h l0); auto.</span>
<span class="c">Qed. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk3c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk3c"><span class="kn">Lemma</span> <span class="nf">hdisjoint_empty</span>:
  <span class="kr">forall</span> <span class="nv">h</span>, hdisjoint hempty h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h</span> : heap, hdisjoint hempty h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk3d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk3d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h</span> : heap, hdisjoint hempty h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk3e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk3e"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint hempty h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk3f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk3f"><span class="nb">unfold</span> hdisjoint; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hempty l = None \/ h l = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk40" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk40"><span class="nb">left</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hempty l = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk41" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk41"><span class="kn">Lemma</span> <span class="nf">hdisjoint_union_l</span>:
  <span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span>,
  hdisjoint (hunion h1 h2) h3 &lt;-&gt; hdisjoint h1 h3 /\ hdisjoint h2 h3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span> : heap,
hdisjoint (hunion h1 h2) h3 &lt;-&gt;
hdisjoint h1 h3 /\ hdisjoint h2 h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk42" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk42"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span> : heap,
hdisjoint (hunion h1 h2) h3 &lt;-&gt;
hdisjoint h1 h3 /\ hdisjoint h2 h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk43" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk43"><span class="nb">unfold</span> hdisjoint, hunion; <span class="nb">cbn</span>; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">l</span> : addr,
 (<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l) = None \/ h3 l = None) &lt;-&gt;
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = None \/ h3 l = None) /\
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h2 l = None \/ h3 l = None)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk44" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk44"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">l</span> : addr,
 (<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l) = None \/ h3 l = None) -&gt;
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = None \/ h3 l = None) /\
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h2 l = None \/ h3 l = None)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk45" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk45"><hr></label><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = None \/ h3 l = None) /\
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h2 l = None \/ h3 l = None) -&gt;
<span class="kr">forall</span> <span class="nv">l</span> : addr,
(<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l) = None \/ h3 l = None</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk46" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk46">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">l</span> : addr,
 (<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l) = None \/ h3 l = None) -&gt;
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = None \/ h3 l = None) /\
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h2 l = None \/ h3 l = None)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk47" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk47"><span class="nb">intros</span> D; <span class="nb">split</span>; <span class="nb">intros</span> l; <span class="nb">destruct</span> (D l); <span class="nb">auto</span>; <span class="nb">destruct</span> (h1 l); <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr,
(<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l) = None \/
h3 l = None</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>z</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some z = None</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h2 l = None \/ h3 l = None</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">discriminate</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk48" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk48">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = None \/ h3 l = None) /\
(<span class="kr">forall</span> <span class="nv">l</span> : addr, h2 l = None \/ h3 l = None) -&gt;
<span class="kr">forall</span> <span class="nv">l</span> : addr,
(<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l) = None \/ h3 l = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk49" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk49"><span class="nb">intros</span> [D1 D2] l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = None \/ h3 l = None</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr, h2 l = None \/ h3 l = None</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l) = None \/ h3 l = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk4a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk4a"><span class="nb">destruct</span> (D2 l); <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = None \/ h3 l = None</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr, h2 l = None \/ h3 l = None</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>h2 l = None</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">if</span> h1 l <span class="kr">then</span> h1 l <span class="kr">else</span> h2 l) = None \/ h3 l = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk4b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk4b"><span class="nb">destruct</span> (h1 l) <span class="nb">eqn</span>:H1; <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = None \/ h3 l = None</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr, h2 l = None \/ h3 l = None</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>h2 l = None</span></span></span><br><span><var>z</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>h1 l = Some z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some z = None \/ h3 l = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk4c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk4c"><span class="nb">destruct</span> (D1 l); <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr, h1 l = None \/ h3 l = None</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">l</span> : addr, h2 l = None \/ h3 l = None</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>h2 l = None</span></span></span><br><span><var>z</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>h1 l = Some z</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>h1 l = None</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some z = None \/ h3 l = None</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk4d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk4d"><span class="kn">Lemma</span> <span class="nf">hdisjoint_union_r</span>:
  <span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span>,
  hdisjoint h1 (hunion h2 h3) &lt;-&gt; hdisjoint h1 h2 /\ hdisjoint h1 h3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span> : heap,
hdisjoint h1 (hunion h2 h3) &lt;-&gt;
hdisjoint h1 h2 /\ hdisjoint h1 h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk4e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk4e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span> : heap,
hdisjoint h1 (hunion h2 h3) &lt;-&gt;
hdisjoint h1 h2 /\ hdisjoint h1 h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk4f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk4f"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h1 (hunion h2 h3) &lt;-&gt;
hdisjoint h1 h2 /\ hdisjoint h1 h3</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk50" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk50"><span class="nb">rewrite</span> hdisjoint_sym.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint (hunion h2 h3) h1 &lt;-&gt;
hdisjoint h1 h2 /\ hdisjoint h1 h3</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk51" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk51"><span class="nb">rewrite</span> hdisjoint_union_l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h2 h1 /\ hdisjoint h3 h1 &lt;-&gt;
hdisjoint h1 h2 /\ hdisjoint h1 h3</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk52" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk52"><span class="nb">rewrite</span> (hdisjoint_sym h2), (hdisjoint_sym h3).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h1 h2 /\ hdisjoint h1 h3 &lt;-&gt;
hdisjoint h1 h2 /\ hdisjoint h1 h3</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
Disjointness between three heaps. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">hdisj3</span> (<span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h3</span>: heap) :=
  hdisjoint h1 h2 /\ hdisjoint h1 h3 /\ hdisjoint h2 h3.</span></span></pre><div class="doc">
A tactic to prove disjointness statements. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">HDISJ</span> :=
  <span class="kr">match goal with</span>
  | [ H: hdisj3 _ _ _ |- _ ] =&gt;
      <span class="nb">destruct</span> H <span class="kr">as</span> (? &amp; ? &amp; ?); HDISJ
  | [ H: hdisjoint (hunion _ _) _ |- _ ] =&gt;
      <span class="nb">apply</span> hdisjoint_union_l <span class="kr">in</span> H; <span class="nb">destruct</span> H; HDISJ
  | [ H: hdisjoint _ (hunion _ _) |- _ ] =&gt;
      <span class="nb">apply</span> hdisjoint_union_r <span class="kr">in</span> H; <span class="nb">destruct</span> H; HDISJ
  | [ |- hdisj3 _ _ _ ] =&gt;
      <span class="nb">split</span>; [|<span class="nb">split</span>]; HDISJ
  | [ |- hdisjoint (hunion _ _) _ ] =&gt;
      <span class="nb">apply</span> hdisjoint_union_l; <span class="nb">split</span>; HDISJ
  | [ |- hdisjoint _ (hunion _ _) ] =&gt;
      <span class="nb">apply</span> hdisjoint_union_r; <span class="nb">split</span>; HDISJ
  | [ |- hdisjoint hempty _ ] =&gt;
      <span class="nb">red</span>; <span class="nb">auto</span>
  | [ |- hdisjoint _ hempty ] =&gt;
      <span class="nb">red</span>; <span class="nb">auto</span>
  | [ |- hdisjoint _ _ ] =&gt;
      <span class="bp">assumption</span> || (<span class="nb">apply</span> hdisjoint_sym; <span class="bp">assumption</span>) || <span class="kp">idtac</span>
  | _ =&gt; <span class="kp">idtac</span>
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk53" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk53"><span class="kn">Lemma</span> <span class="nf">hunion_invert_r</span>:
  <span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h</span>,
  hunion h h1 = hunion h h2 -&gt; hdisjoint h h1 -&gt; hdisjoint h h2 -&gt; h1 = h2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h</span> : heap,
hunion h h1 = hunion h h2 -&gt;
hdisjoint h h1 -&gt; hdisjoint h h2 -&gt; h1 = h2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk54" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk54"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h</span> : heap,
hunion h h1 = hunion h h2 -&gt;
hdisjoint h h1 -&gt; hdisjoint h h2 -&gt; h1 = h2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk55" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk55"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h h1 = hunion h h2</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h h1</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h1 = h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk56" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk56"><span class="nb">apply</span> heap_extensionality; <span class="nb">intros</span> l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h h1 = hunion h h2</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h h1</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h h2</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h1 l = h2 l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk57" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk57"><span class="nb">assert</span> (hunion h h1 l = hunion h h2 l) <span class="bp">by</span> <span class="bp">congruence</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h h1 = hunion h h2</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h h1</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h h2</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>hunion h h1 l = hunion h h2 l</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h1 l = h2 l</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk58" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk58"><span class="nb">cbn</span> <span class="kr">in</span> H2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h h1 = hunion h h2</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h h1</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h h2</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>(<span class="kr">if</span> h l <span class="kr">then</span> h l <span class="kr">else</span> h1 l) =
(<span class="kr">if</span> h l <span class="kr">then</span> h l <span class="kr">else</span> h2 l)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h1 l = h2 l</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk59" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk59"><span class="nb">specialize</span> (H0 l); <span class="nb">specialize</span> (H1 l).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h h1 = hunion h h2</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>h l = None \/ h1 l = None</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>h l = None \/ h2 l = None</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>(<span class="kr">if</span> h l <span class="kr">then</span> h l <span class="kr">else</span> h1 l) =
(<span class="kr">if</span> h l <span class="kr">then</span> h l <span class="kr">else</span> h2 l)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h1 l = h2 l</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> (h l); <span class="nb">intuition</span> <span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk5a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk5a"><span class="kn">Lemma</span> <span class="nf">hunion_invert_l</span>:
  <span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h</span>,
  hunion h1 h = hunion h2 h -&gt; hdisjoint h1 h -&gt; hdisjoint h2 h -&gt; h1 = h2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h</span> : heap,
hunion h1 h = hunion h2 h -&gt;
hdisjoint h1 h -&gt; hdisjoint h2 h -&gt; h1 = h2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk5b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk5b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h1</span> <span class="nv">h2</span> <span class="nv">h</span> : heap,
hunion h1 h = hunion h2 h -&gt;
hdisjoint h1 h -&gt; hdisjoint h2 h -&gt; h1 = h2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk5c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk5c"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h1 = h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk5d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk5d"><span class="nb">apply</span> hunion_invert_r <span class="kr">with</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hunion h h1 = hunion h h2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk5e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk5e"><hr></label><div class="goal-conclusion">hdisjoint h h1</div></blockquote><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk5f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk5f"><hr></label><div class="goal-conclusion">hdisjoint h h2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk60" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk60"><span class="nb">rewrite</span> &lt;- ! (hunion_comm h) <span class="bp">by</span> HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hunion h1 h = hunion h2 h</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk61" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk61"><hr></label><div class="goal-conclusion">hdisjoint h h1</div></blockquote><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk62" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk62"><hr></label><div class="goal-conclusion">hdisjoint h h2</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk63" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk63"><span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h h1</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk64" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk64"><hr></label><div class="goal-conclusion">hdisjoint h h2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk65" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk65">HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>h1, h2, h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hunion h1 h = hunion h2 h</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">HDISJ.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp"> </span></span></pre><div class="doc">
<a id="lab2"></a><h1 class="section">2. Assertions for separation logic</h1>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">assertion</span> : <span class="kt">Type</span> := store Z -&gt; heap -&gt; <span class="kt">Prop</span>.</span></span></pre><div class="doc">
Implication (entailment). 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">aimp</span> (<span class="nv">P</span> <span class="nv">Q</span>: assertion) : <span class="kt">Prop</span> :=
  <span class="kr">forall</span> <span class="nv">s</span> <span class="nv">h</span>, P s h -&gt; Q s h.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="s2">&quot;P --&gt;&gt; Q&quot;</span> := (aimp P Q) (<span class="kn">at level</span> <span class="mi">95</span>, <span class="kn">no associativity</span>).</span></span></pre><div class="doc">
Quantification. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">aexists</span> {<span class="nv">A</span>: <span class="kt">Type</span>} (<span class="nv">P</span>: A -&gt; assertion) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; <span class="kr">exists</span> <span class="nv">a</span>: A, P a s h.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">aforall</span> {<span class="nv">A</span>: <span class="kt">Type</span>} (<span class="nv">P</span>: A -&gt; assertion) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; <span class="kr">forall</span> <span class="nv">a</span>: A, P a s h.</span></span></pre><div class="doc">
The assertion "the heap is empty". 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">emp</span> : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; h = hempty.</span></span></pre><div class="doc">
The pure assertion: "the heap is empty and P holds". 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">pure</span> (<span class="nv">P</span>: <span class="kt">Prop</span>) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; P /\ h = hempty.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* TODO pure assertions *)</span></span></pre><div class="doc">
The assertion "address <span class="inlinecode"><span class="id" title="var">l</span></span> contains value <span class="inlinecode"><span class="id" title="var">v</span></span>". 
    The domain of the heap must be the singleton <span class="inlinecode">{<span class="id" title="var">l</span>}</span>. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">contains</span> (<span class="nv">l</span>: addr) (<span class="nv">v</span>: Z) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; h = hupdate l v hempty.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">pts</span> (<span class="nv">x</span>: ident) (<span class="nv">y</span>: ident) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt;
    <span class="kr">exists</span> <span class="nv">v</span> <span class="nv">w</span>, Some v = s x /\ Some w = s y /\
      contains v w s h.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">ptsval</span> (<span class="nv">x</span>: ident) (<span class="nv">v</span>: Z) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt;
    <span class="kr">exists</span> <span class="nv">w</span>, Some w = s x /\
      contains w v s h.</span></span></pre><div class="doc">
The assertion "address <span class="inlinecode"><span class="id" title="var">l</span></span> is valid" (i.e. in the domain of the heap). 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">valid</span> (<span class="nv">l</span>: addr) : assertion := aexists (contains l).</span></span></pre><div class="doc">
The separating conjunction. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">sepconj</span> (<span class="nv">P</span> <span class="nv">Q</span>: assertion) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; <span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span>, P s h1
                      /\ Q s h2
                      /\ hdisjoint h1 h2  /\ h = hunion h1 h2.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="s2">&quot;P ** Q&quot;</span> := (sepconj P Q) (<span class="kn">at level</span> <span class="mi">60</span>, <span class="kn">right associativity</span>).</span></span></pre><div class="doc">
The conjunction of a simple assertion and a general assertion. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">pureconj</span> (<span class="nv">P</span>: <span class="kt">Prop</span>) (<span class="nv">Q</span>: assertion) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; P /\ Q s h.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* TODO pure assertions *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="s2">&quot;P //\\ Q&quot;</span> := (pureconj P Q) (<span class="kn">at level</span> <span class="mi">60</span>, <span class="kn">right associativity</span>).</span></span></pre><div class="doc">
Plain conjunction and disjunction. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">aand</span> (<span class="nv">P</span> <span class="nv">Q</span>: assertion) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; P s h /\ Q s h.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">aor</span> (<span class="nv">P</span> <span class="nv">Q</span>: assertion) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; P s h \/ Q s h.</span></span></pre><div class="doc">
Extensional equality between assertions. 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk66" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk66"><span class="kn">Lemma</span> <span class="nf">assertion_extensionality</span>:
  <span class="kr">forall</span> (<span class="nv">P</span> <span class="nv">Q</span>: assertion),
  (<span class="kr">forall</span> <span class="nv">s</span> <span class="nv">h</span>, P s h &lt;-&gt; Q s h) -&gt; P = Q.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion,
(<span class="kr">forall</span> (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap), P s h &lt;-&gt; Q s h) -&gt;
P = Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk67" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk67"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion,
(<span class="kr">forall</span> (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap), P s h &lt;-&gt; Q s h) -&gt;
P = Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk68" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk68"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap), P s h &lt;-&gt; Q s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P = Q</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk69" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk69"><span class="nb">apply</span> functional_extensionality.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap), P s h &lt;-&gt; Q s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">x</span> : store Z, P x = Q x</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk6a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk6a"><span class="nb">intros</span> s.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap), P s h &lt;-&gt; Q s h</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s = Q s</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk6b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk6b"><span class="nb">apply</span> functional_extensionality.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap), P s h &lt;-&gt; Q s h</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">x</span> : heap, P s x = Q s x</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk6c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk6c"><span class="nb">intros</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap), P s h &lt;-&gt; Q s h</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s h = Q s h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk6d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk6d"><span class="nb">apply</span> propositional_extensionality.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap), P s h &lt;-&gt; Q s h</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s h &lt;-&gt; Q s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab3"></a><h2 class="section">Properties of separating conjunction</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk6e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk6e"><span class="kn">Lemma</span> <span class="nf">sepconj_comm</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span>, P ** Q = Q ** P.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion, P ** Q = Q ** P</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk6f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk6f"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion, P ** Q = Q ** P</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk70" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk70"><span class="nb">assert</span> (<span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">s</span> <span class="nv">h</span>, (P ** Q) s h -&gt; (Q ** P) s h).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">P</span> <span class="nv">Q</span> : assertion) (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap),
(P ** Q) s h -&gt; (Q ** P) s h</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk71" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">P</span> <span class="nv">Q</span> : assertion) (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap),
(P ** Q) s h -&gt; (Q ** P) s h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk71"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion, P ** Q = Q ** P</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk72" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk72">{</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">P</span> <span class="nv">Q</span> : assertion) (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap),
(P ** Q) s h -&gt; (Q ** P) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk73" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk73"><span class="nb">intros</span> P Q s h (h1 &amp; h2 &amp; P1 &amp; Q2 &amp; EQ &amp; DISJ); <span class="nb">subst</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(Q ** P) s (hunion h1 h2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk74" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk74"><span class="kr">exists</span> <span class="nv">h2</span>, h1; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h2 h1</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk75" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk75"><hr></label><div class="goal-conclusion">hunion h1 h2 = hunion h2 h1</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk76" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk76"><span class="nb">apply</span> hdisjoint_sym; <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hunion h1 h2 = hunion h2 h1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">symmetry</span>; <span class="nb">apply</span> hunion_comm; <span class="nb">auto</span>.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk77" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk77">}</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">P</span> <span class="nv">Q</span> : assertion) (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap),
(P ** Q) s h -&gt; (Q ** P) s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion, P ** Q = Q ** P</div></blockquote></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intros</span>; <span class="nb">apply</span> assertion_extensionality; <span class="nb">intros</span>; <span class="nb">split</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk78" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk78"><span class="kn">Lemma</span> <span class="nf">sepconj_assoc</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span>, (P ** Q) ** R = P ** (Q ** R).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion, (P ** Q) ** R = P ** Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk79" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk79"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion, (P ** Q) ** R = P ** Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk7a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk7a"><span class="nb">intros</span>; <span class="nb">apply</span> assertion_extensionality; <span class="nb">intros</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((P ** Q) ** R) s h -&gt; (P ** Q ** R) s h</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk7b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk7b"><hr></label><div class="goal-conclusion">(P ** Q ** R) s h -&gt; ((P ** Q) ** R) s h</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk7c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk7c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((P ** Q) ** R) s h -&gt; (P ** Q ** R) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk7d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk7d"><span class="nb">intros</span> (hx &amp; h3 &amp; (h1 &amp; h2 &amp; P1 &amp; Q2 &amp; EQ &amp; DISJ) &amp; R3 &amp; EQ&#39; &amp; DISJ&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, hx, h3, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hx = hunion h1 h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ'</var><span class="hyp-type"><b>: </b><span>hdisjoint hx h3</span></span></span><br><span><var>DISJ'</var><span class="hyp-type"><b>: </b><span>h = hunion hx h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q ** R) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk7e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk7e"><span class="nb">subst</span> hx h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h3, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q ** R) s (hunion (hunion h1 h2) h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk7f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk7f"><span class="nb">rewrite</span> hdisjoint_union_l <span class="kr">in</span> EQ&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h3, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ'</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h3 /\ hdisjoint h2 h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q ** R) s (hunion (hunion h1 h2) h3)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk80" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk80"><span class="nb">rewrite</span> hunion_assoc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h3, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ'</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h3 /\ hdisjoint h2 h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q ** R) s (hunion h1 (hunion h2 h3))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk81" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk81"><span class="kr">exists</span> <span class="nv">h1</span>, (hunion h2 h3); <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h3, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h3</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(Q ** R) s (hunion h2 h3)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk82" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h3, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h3</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk82"><hr></label><div class="goal-conclusion">hdisjoint h1 (hunion h2 h3)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk83" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk83"><span class="kr">exists</span> <span class="nv">h2</span>, h3; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h3, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h3</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h1 (hunion h2 h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> hdisjoint_union_r; <span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk84" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk84">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q ** R) s h -&gt; ((P ** Q) ** R) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk85" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk85"><span class="nb">intros</span> (h1 &amp; hx &amp; P1 &amp; (h2 &amp; h3 &amp; Q2 &amp; R3 &amp; EQ &amp; DISJ) &amp; EQ&#39; &amp; DISJ&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, hx</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hx = hunion h2 h3</span></span></span><br><span><var>EQ'</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 hx</span></span></span><br><span><var>DISJ'</var><span class="hyp-type"><b>: </b><span>h = hunion h1 hx</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((P ** Q) ** R) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk86" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk86"><span class="nb">subst</span> hx h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br><span><var>EQ'</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 (hunion h2 h3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((P ** Q) ** R) s (hunion h1 (hunion h2 h3))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk87" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk87"><span class="nb">rewrite</span> hdisjoint_union_r <span class="kr">in</span> EQ&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br><span><var>EQ'</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2 /\ hdisjoint h1 h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((P ** Q) ** R) s (hunion h1 (hunion h2 h3))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk88" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk88"><span class="nb">rewrite</span> &lt;- hunion_assoc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br><span><var>EQ'</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2 /\ hdisjoint h1 h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((P ** Q) ** R) s (hunion (hunion h1 h2) h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk89" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk89"><span class="kr">exists</span> (<span class="nv">hunion</span> <span class="nv">h1</span> <span class="nv">h2</span>), h3; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q) s (hunion h1 h2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk8a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h3</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk8a"><hr></label><div class="goal-conclusion">hdisjoint (hunion h1 h2) h3</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk8b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk8b"><span class="kr">exists</span> <span class="nv">h1</span>, h2; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>h2, h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>R3</var><span class="hyp-type"><b>: </b><span>R s h3</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h3</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint (hunion h1 h2) h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> hdisjoint_union_l; <span class="bp">tauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk8c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk8c"><span class="kn">Lemma</span> <span class="nf">sepconj_emp</span>: <span class="kr">forall</span> <span class="nv">P</span>, emp ** P = P.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> : assertion, emp ** P = P</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk8d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk8d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> : assertion, emp ** P = P</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk8e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk8e"><span class="nb">intros</span>; <span class="nb">apply</span> assertion_extensionality; <span class="nb">intros</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(emp ** P) s h -&gt; P s h</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk8f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk8f"><hr></label><div class="goal-conclusion">P s h -&gt; (emp ** P) s h</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk90" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk90">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(emp ** P) s h -&gt; P s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk91" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk91"><span class="nb">intros</span> (h1 &amp; h2 &amp; EMP1 &amp; P2 &amp; EQ &amp; DISJ).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>EMP1</var><span class="hyp-type"><b>: </b><span>emp s h1</span></span></span><br><span><var>P2</var><span class="hyp-type"><b>: </b><span>P s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk92" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk92"><span class="nb">red</span> <span class="kr">in</span> EMP1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>EMP1</var><span class="hyp-type"><b>: </b><span>h1 = hempty</span></span></span><br><span><var>P2</var><span class="hyp-type"><b>: </b><span>P s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk93" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk93"><span class="nb">subst</span> h h1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P2</var><span class="hyp-type"><b>: </b><span>P s h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>hdisjoint hempty h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s (hunion hempty h2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> hunion_empty; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk94" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk94">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s h -&gt; (emp ** P) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk95" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk95"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(emp ** P) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk96" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk96"><span class="kr">exists</span> <span class="nv">hempty</span>, h; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">emp s hempty</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk97" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P s h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk97"><hr></label><div class="goal-conclusion">hdisjoint hempty h</div></blockquote><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk98" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P s h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk98"><hr></label><div class="goal-conclusion">h = hunion hempty h</div></blockquote></div></div></div></small><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk99" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk99"><span class="nb">red</span>; <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint hempty h</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk9a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P s h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk9a"><hr></label><div class="goal-conclusion">h = hunion hempty h</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk9b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk9b"><span class="nb">red</span>; <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h = hunion hempty h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> hunion_empty; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk9c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk9c"><span class="kn">Lemma</span> <span class="nf">sepconj_imp_l</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span>,
  (P --&gt;&gt; Q) -&gt; (P ** R --&gt;&gt; Q ** R).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
P --&gt;&gt; Q -&gt; P ** R --&gt;&gt; Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk9d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk9d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
P --&gt;&gt; Q -&gt; P ** R --&gt;&gt; Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk9e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk9e"><span class="nb">intros</span> P Q R IMP s h (h1 &amp; h2 &amp; P1 &amp; Q2 &amp; D &amp; U).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>IMP</var><span class="hyp-type"><b>: </b><span>P --&gt;&gt; Q</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>U</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(Q ** R) s h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">h1</span>, h2; <span class="nb">intuition</span> <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk9f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk9f"><span class="kn">Lemma</span> <span class="nf">sepconj_imp_r</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span>,
  (P --&gt;&gt; Q) -&gt; (R ** P --&gt;&gt; R ** Q).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
P --&gt;&gt; Q -&gt; R ** P --&gt;&gt; R ** Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka0" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka0"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
P --&gt;&gt; Q -&gt; R ** P --&gt;&gt; R ** Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka1" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka1"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P --&gt;&gt; Q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R ** P --&gt;&gt; R ** Q</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka2" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka2"><span class="nb">rewrite</span> ! (sepconj_comm R).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P --&gt;&gt; Q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P ** R --&gt;&gt; Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> sepconj_imp_l; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab4"></a><h2 class="section">Other useful logical properties</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka3" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka3"><span class="kn">Lemma</span> <span class="nf">pure_sep</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span>,
  pure (P /\ Q) = pure P ** pure Q.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : <span class="kt">Prop</span>, pure (P /\ Q) = pure P ** pure Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka4" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : <span class="kt">Prop</span>, pure (P /\ Q) = pure P ** pure Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka5" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka5"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure (P /\ Q) = pure P ** pure Q</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka6" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka6"><span class="nb">apply</span> assertion_extensionality; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure (P /\ Q) s h &lt;-&gt; (pure P ** pure Q) s h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka7" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka7"><span class="nb">unfold</span> pure, sepconj.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P /\ Q) /\ h = hempty &lt;-&gt;
(<span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
   (P /\ h1 = hempty) /\
   (Q /\ h2 = hempty) /\
   hdisjoint h1 h2 /\ h = hunion h1 h2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chka8" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chka8"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P /\ Q) /\ h = hempty -&gt;
<span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
  (P /\ h1 = hempty) /\
  (Q /\ h2 = hempty) /\
  hdisjoint h1 h2 /\ h = hunion h1 h2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chka9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chka9"><hr></label><div class="goal-conclusion">(<span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
   (P /\ h1 = hempty) /\
   (Q /\ h2 = hempty) /\
   hdisjoint h1 h2 /\ h = hunion h1 h2) -&gt;
(P /\ Q) /\ h = hempty</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkaa" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkaa">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P /\ Q) /\ h = hempty -&gt;
<span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
  (P /\ h1 = hempty) /\
  (Q /\ h2 = hempty) /\
  hdisjoint h1 h2 /\ h = hunion h1 h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkab" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkab"><span class="nb">intros</span> ((A &amp; B) &amp; C).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q</span></span></span><br><span><var>C</var><span class="hyp-type"><b>: </b><span>h = hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
  (P /\ h1 = hempty) /\
  (Q /\ h2 = hempty) /\
  hdisjoint h1 h2 /\ h = hunion h1 h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkac" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkac"><span class="nb">subst</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
  (P /\ h1 = hempty) /\
  (Q /\ h2 = hempty) /\
  hdisjoint h1 h2 /\ hempty = hunion h1 h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkad" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkad"><span class="kr">exists</span> <span class="nv">hempty</span>, hempty; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint hempty hempty</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chkae" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chkae"><hr></label><div class="goal-conclusion">hempty = hunion hempty hempty</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkaf" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkaf"><span class="nb">intro</span>; <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hempty = hunion hempty hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> hunion_empty; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb0" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb0">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
   (P /\ h1 = hempty) /\
   (Q /\ h2 = hempty) /\
   hdisjoint h1 h2 /\ h = hunion h1 h2) -&gt;
(P /\ Q) /\ h = hempty</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb1" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb1"><span class="nb">intros</span> (h1 &amp; h2 &amp; (PP &amp; E1) &amp; (QQ &amp; E2) &amp; C &amp; D).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>E1</var><span class="hyp-type"><b>: </b><span>h1 = hempty</span></span></span><br><span><var>QQ</var><span class="hyp-type"><b>: </b><span>Q</span></span></span><br><span><var>E2</var><span class="hyp-type"><b>: </b><span>h2 = hempty</span></span></span><br><span><var>C</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P /\ Q) /\ h = hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb2" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb2"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>QQ</var><span class="hyp-type"><b>: </b><span>Q</span></span></span><br><span><var>C</var><span class="hyp-type"><b>: </b><span>hdisjoint hempty hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P /\ Q) /\ hunion hempty hempty = hempty</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> hunion_empty; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb3" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb3"><span class="kn">Lemma</span> <span class="nf">pureconj_sepconj</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span>,
  pure P ** Q = P //\\ Q.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">P</span> : <span class="kt">Prop</span>) (<span class="nv">Q</span> : assertion),
pure P ** Q = P //\\ Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb4" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb4"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">P</span> : <span class="kt">Prop</span>) (<span class="nv">Q</span> : assertion),
pure P ** Q = P //\\ Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb5" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb5"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure P ** Q = P //\\ Q</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb6" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb6"><span class="nb">apply</span> assertion_extensionality; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(pure P ** Q) s h &lt;-&gt; (P //\\ Q) s h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb7" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb7"><span class="nb">unfold</span> pure, sepconj, pureconj; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
   (P /\ h1 = hempty) /\
   Q s h2 /\ hdisjoint h1 h2 /\ h = hunion h1 h2) -&gt;
P /\ Q s h</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chkb8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chkb8"><hr></label><div class="goal-conclusion">P /\ Q s h -&gt;
<span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
  (P /\ h1 = hempty) /\
  Q s h2 /\ hdisjoint h1 h2 /\ h = hunion h1 h2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkb9" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkb9">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(<span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
   (P /\ h1 = hempty) /\
   Q s h2 /\ hdisjoint h1 h2 /\ h = hunion h1 h2) -&gt;
P /\ Q s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkba" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkba"><span class="nb">intros</span> (h1 &amp; h2 &amp; (A &amp; B) &amp; C &amp; D &amp; E).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>h1 = hempty</span></span></span><br><span><var>C</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P /\ Q s h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkbb" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkbb"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>h1 = hempty</span></span></span><br><span><var>C</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chkbc" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>h1 = hempty</span></span></span><br><span><var>C</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chkbc"><hr></label><div class="goal-conclusion">Q s h</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkbd" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkbd"><span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>h1 = hempty</span></span></span><br><span><var>C</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkbe" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkbe"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>C</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint hempty h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s (hunion hempty h2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkbf" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkbf"><span class="nb">rewrite</span> hunion_empty.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>C</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint hempty h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkc0" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkc0">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P /\ Q s h -&gt;
<span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
  (P /\ h1 = hempty) /\
  Q s h2 /\ hdisjoint h1 h2 /\ h = hunion h1 h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkc1" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkc1"><span class="nb">intros</span> (A &amp; B).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">h1</span> <span class="nv">h2</span> : heap,
  (P /\ h1 = hempty) /\
  Q s h2 /\ hdisjoint h1 h2 /\ h = hunion h1 h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkc2" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkc2"><span class="kr">exists</span> <span class="nv">hempty</span>, h; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint hempty h</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chkc3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q s h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chkc3"><hr></label><div class="goal-conclusion">h = hunion hempty h</div></blockquote></div></div></div></small><span class="alectryon-wsp">  
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkc4" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkc4"><span class="nb">intro</span> l.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q s h</span></span></span><br><span><var>l</var><span class="hyp-type"><b>: </b><span>addr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hempty l = None \/ h l = None</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chkc5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q s h</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chkc5"><hr></label><div class="goal-conclusion">h = hunion hempty h</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkc6" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkc6"><span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>Q s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h = hunion hempty h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">rewrite</span> hunion_empty; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkc7" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkc7"><span class="kn">Lemma</span> <span class="nf">lift_pureconj</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span>, (P //\\ Q) ** R = P //\\ (Q ** R).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">P</span> : <span class="kt">Prop</span>) (<span class="nv">Q</span> <span class="nv">R</span> : assertion),
(P //\\ Q) ** R = P //\\ Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkc8" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkc8"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">P</span> : <span class="kt">Prop</span>) (<span class="nv">Q</span> <span class="nv">R</span> : assertion),
(P //\\ Q) ** R = P //\\ Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkc9" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkc9"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P //\\ Q) ** R = P //\\ Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkca" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkca"><span class="nb">rewrite</span> &lt;- ! pureconj_sepconj.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(pure P ** Q) ** R = pure P ** Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkcb" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkcb"><span class="nb">rewrite</span> sepconj_assoc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure P ** Q ** R = pure P ** Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkcc" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkcc"><span class="kn">Lemma</span> <span class="nf">lift_aexists</span>: <span class="kr">forall</span> (<span class="nv">A</span>: <span class="kt">Type</span>) (<span class="nv">P</span>: A -&gt; assertion) <span class="nv">Q</span>,
  aexists P ** Q = aexists (<span class="kr">fun</span> <span class="nv">x</span> =&gt; P x ** Q).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> : <span class="kt">Type</span>) (<span class="nv">P</span> : A -&gt; assertion) (<span class="nv">Q</span> : assertion),
aexists P ** Q = aexists (<span class="kr">fun</span> <span class="nv">x</span> : A =&gt; P x ** Q)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkcd" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkcd"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">A</span> : <span class="kt">Type</span>) (<span class="nv">P</span> : A -&gt; assertion) (<span class="nv">Q</span> : assertion),
aexists P ** Q = aexists (<span class="kr">fun</span> <span class="nv">x</span> : A =&gt; P x ** Q)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkce" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkce"><span class="nb">intros</span>; <span class="nb">apply</span> assertion_extensionality; <span class="nb">intros</span>; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A -&gt; assertion</span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(aexists P ** Q) s h -&gt;
aexists (<span class="kr">fun</span> <span class="nv">x</span> : A =&gt; P x ** Q) s h</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chkcf" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A -&gt; assertion</span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chkcf"><hr></label><div class="goal-conclusion">aexists (<span class="kr">fun</span> <span class="nv">x</span> : A =&gt; P x ** Q) s h -&gt;
(aexists P ** Q) s h</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd0" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd0">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A -&gt; assertion</span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(aexists P ** Q) s h -&gt;
aexists (<span class="kr">fun</span> <span class="nv">x</span> : A =&gt; P x ** Q) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd1" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd1"><span class="nb">intros</span> (h1 &amp; h2 &amp; (a &amp; P1) &amp; Q2 &amp; DISJ &amp; EQ).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A -&gt; assertion</span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P a s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aexists (<span class="kr">fun</span> <span class="nv">x</span> : A =&gt; P x ** Q) s h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">a</span>, h1, h2; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd2" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd2">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A -&gt; assertion</span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aexists (<span class="kr">fun</span> <span class="nv">x</span> : A =&gt; P x ** Q) s h -&gt;
(aexists P ** Q) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd3" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd3"><span class="nb">intros</span> (a &amp; h1 &amp; h2 &amp; P1 &amp; Q2 &amp; DISJ &amp; EQ).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A -&gt; assertion</span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P a s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(aexists P ** Q) s h</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd4" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd4"><span class="kr">exists</span> <span class="nv">h1</span>, h2; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>A</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>P</var><span class="hyp-type"><b>: </b><span>A -&gt; assertion</span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>A</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>P1</var><span class="hyp-type"><b>: </b><span>P a s h1</span></span></span><br><span><var>Q2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>EQ</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aexists P s h1</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">a</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd5" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd5"><span class="kn">Lemma</span> <span class="nf">sepconj_swap3</span>: <span class="kr">forall</span> <span class="nv">R</span> <span class="nv">P</span> <span class="nv">Q</span>, P ** Q ** R = R ** P ** Q.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">R</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion, P ** Q ** R = R ** P ** Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd6" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">R</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion, P ** Q ** R = R ** P ** Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd7" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd7"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>R, P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P ** Q ** R = R ** P ** Q</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd8" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd8"><span class="nb">rewrite</span> &lt;- sepconj_assoc, sepconj_comm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>R, P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R ** P ** Q = R ** P ** Q</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkd9" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkd9"><span class="kn">Lemma</span> <span class="nf">sepconj_swap4</span>: <span class="kr">forall</span> <span class="nv">S</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span>, P ** Q ** R ** S = S ** P ** Q ** R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">S</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
P ** Q ** R ** S = S ** P ** Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkda" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkda"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">S</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
P ** Q ** R ** S = S ** P ** Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkdb" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkdb"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>S, P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P ** Q ** R ** S = S ** P ** Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkdc" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkdc"><span class="nb">rewrite</span> &lt;- sepconj_assoc, sepconj_swap3, sepconj_assoc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>S, P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">S ** P ** Q ** R = S ** P ** Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkdd" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkdd"><span class="kn">Lemma</span> <span class="nf">sepconj_pick2</span>: <span class="kr">forall</span> <span class="nv">Q</span> <span class="nv">P</span> <span class="nv">R</span>, P ** Q ** R = Q ** P ** R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">Q</span> <span class="nv">P</span> <span class="nv">R</span> : assertion, P ** Q ** R = Q ** P ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkde" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkde"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">Q</span> <span class="nv">P</span> <span class="nv">R</span> : assertion, P ** Q ** R = Q ** P ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkdf" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkdf"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>Q, P, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P ** Q ** R = Q ** P ** R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke0" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke0"><span class="nb">rewrite</span> (sepconj_comm Q), &lt;- sepconj_assoc, sepconj_comm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>Q, P, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q ** P ** R = Q ** P ** R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke1" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke1"><span class="kn">Lemma</span> <span class="nf">sepconj_pick3</span>: <span class="kr">forall</span> <span class="nv">R</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">S</span>, P ** Q ** R ** S = R ** P ** Q ** S.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">R</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">S</span> : assertion,
P ** Q ** R ** S = R ** P ** Q ** S</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke2" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">R</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">S</span> : assertion,
P ** Q ** R ** S = R ** P ** Q ** S</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke3" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke3"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>R, P, Q, S</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P ** Q ** R ** S = R ** P ** Q ** S</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke4" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke4"><span class="nb">rewrite</span> (sepconj_pick2 R), (sepconj_pick2 P).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>R, P, Q, S</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P ** R ** Q ** S = P ** R ** Q ** S</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp"> 
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab5"></a><h2 class="section">Magic wand</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">wand</span> (<span class="nv">P</span> <span class="nv">Q</span>: assertion) : assertion :=
  <span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; <span class="kr">forall</span> <span class="nv">h&#39;</span>, hdisjoint h h&#39; -&gt; P s h&#39; -&gt; Q s (hunion h h&#39;).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Notation</span> <span class="s2">&quot;P --* Q&quot;</span> := (wand P Q) (<span class="kn">at level</span> <span class="mi">70</span>, <span class="kn">right associativity</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke5" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke5"><span class="kn">Lemma</span> <span class="nf">wand_intro</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span>,
  P ** Q --&gt;&gt; R  -&gt;  P --&gt;&gt; Q --* R.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
P ** Q --&gt;&gt; R -&gt; P --&gt;&gt; Q --* R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke6" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke6"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
P ** Q --&gt;&gt; R -&gt; P --&gt;&gt; Q --* R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke7" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke7"><span class="nb">intros</span> P Q R IMP s h Ph h&#39; DISJ Qh&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>IMP</var><span class="hyp-type"><b>: </b><span>P ** Q --&gt;&gt; R</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Ph</var><span class="hyp-type"><b>: </b><span>P s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h h&#39;</span></span></span><br><span><var>Qh'</var><span class="hyp-type"><b>: </b><span>Q s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s (hunion h h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke8" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke8"><span class="nb">apply</span> IMP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>IMP</var><span class="hyp-type"><b>: </b><span>P ** Q --&gt;&gt; R</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Ph</var><span class="hyp-type"><b>: </b><span>P s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h h&#39;</span></span></span><br><span><var>Qh'</var><span class="hyp-type"><b>: </b><span>Q s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q) s (hunion h h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">h</span>, h&#39;; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chke9" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chke9"><span class="kn">Lemma</span> <span class="nf">wand_cancel</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span>,
  P ** (P --* Q) --&gt;&gt; Q.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion, P ** (P --* Q) --&gt;&gt; Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkea" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkea"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion, P ** (P --* Q) --&gt;&gt; Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkeb" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkeb"><span class="nb">intros</span> P Q s h (h1 &amp; h2 &amp; Ph1 &amp; Wh2 &amp; D &amp; U).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Wh2</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>U</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkec" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkec"><span class="nb">subst</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Wh2</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s (hunion h1 h2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chked" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chked"><span class="nb">assert</span> (D&#39;: hdisjoint h2 h1) <span class="bp">by</span> (<span class="nb">apply</span> hdisjoint_sym; <span class="nb">auto</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Wh2</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s (hunion h1 h2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkee" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkee"><span class="nb">rewrite</span> hunion_comm <span class="bp">by</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Wh2</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint h2 h1</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s (hunion h2 h1)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> Wh2; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkef" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkef"><span class="kn">Lemma</span> <span class="nf">wand_charact</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span>,
  (P --*Q) = (aexists (<span class="kr">fun</span> <span class="nv">R</span> =&gt; (P ** R --&gt;&gt; Q) //\\ R)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion,
(P --* Q) =
aexists (<span class="kr">fun</span> <span class="nv">R</span> : assertion =&gt; (P ** R --&gt;&gt; Q) //\\ R)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf0" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf0"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> : assertion,
(P --* Q) =
aexists (<span class="kr">fun</span> <span class="nv">R</span> : assertion =&gt; (P ** R --&gt;&gt; Q) //\\ R)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf1" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf1"><span class="nb">intros</span> P Q; <span class="nb">apply</span> assertion_extensionality; <span class="nb">intros</span> s h; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P --* Q) s h -&gt;
aexists (<span class="kr">fun</span> <span class="nv">R</span> : assertion =&gt; (P ** R --&gt;&gt; Q) //\\ R)
  s h</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chkf2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chkf2"><hr></label><div class="goal-conclusion">aexists (<span class="kr">fun</span> <span class="nv">R</span> : assertion =&gt; (P ** R --&gt;&gt; Q) //\\ R)
  s h -&gt; (P --* Q) s h</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf3" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf3">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P --* Q) s h -&gt;
aexists (<span class="kr">fun</span> <span class="nv">R</span> : assertion =&gt; (P ** R --&gt;&gt; Q) //\\ R)
  s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf4" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf4"><span class="nb">intros</span> W.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aexists (<span class="kr">fun</span> <span class="nv">R</span> : assertion =&gt; (P ** R --&gt;&gt; Q) //\\ R)
  s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf5" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf5"><span class="kr">exists</span> (<span class="nv">P</span> --* Q).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((P ** (P --* Q) --&gt;&gt; Q) //\\ (P --* Q)) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf6" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf6"><span class="nb">split</span>; <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P ** (P --* Q) --&gt;&gt; Q</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> wand_cancel.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf7" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf7">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">aexists (<span class="kr">fun</span> <span class="nv">R</span> : assertion =&gt; (P ** R --&gt;&gt; Q) //\\ R)
  s h -&gt; (P --* Q) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf8" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf8"><span class="nb">intros</span> (R &amp; A &amp; B) h&#39; D Ph&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P ** R --&gt;&gt; Q</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>R s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s (hunion h h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkf9" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkf9"><span class="nb">assert</span> (D&#39;: hdisjoint h&#39; h) <span class="bp">by</span> (<span class="nb">apply</span> hdisjoint_sym; <span class="nb">auto</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P ** R --&gt;&gt; Q</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>R s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint h&#39; h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s (hunion h h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkfa" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkfa"><span class="nb">rewrite</span> hunion_comm <span class="bp">by</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P ** R --&gt;&gt; Q</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>R s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint h&#39; h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s (hunion h&#39; h)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkfb" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkfb"><span class="nb">apply</span> A.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>A</var><span class="hyp-type"><b>: </b><span>P ** R --&gt;&gt; Q</span></span></span><br><span><var>B</var><span class="hyp-type"><b>: </b><span>R s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint h&#39; h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** R) s (hunion h&#39; h)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kr">exists</span> <span class="nv">h&#39;</span>, h; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkfc" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkfc"><span class="kn">Lemma</span> <span class="nf">wand_equiv</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span>,
  (P --&gt;&gt; (Q --* R)) &lt;-&gt; (P ** Q --&gt;&gt; R).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
(P --&gt;&gt; Q --* R) &lt;-&gt; (P ** Q --&gt;&gt; R)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkfd" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkfd"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
(P --&gt;&gt; Q --* R) &lt;-&gt; (P ** Q --&gt;&gt; R)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chkfe" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chkfe"><span class="nb">intros</span>; <span class="nb">split</span>; <span class="nb">intros</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P --&gt;&gt; Q --* R</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P ** Q --&gt;&gt; R</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chkff" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P ** Q --&gt;&gt; R</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chkff"><hr></label><div class="goal-conclusion">P --&gt;&gt; Q --* R</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk100" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk100">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P --&gt;&gt; Q --* R</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P ** Q --&gt;&gt; R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk101" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk101"><span class="nb">intros</span> s h (h1 &amp; h2 &amp; Ph1 &amp; Wh2 &amp; D &amp; U).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P --&gt;&gt; Q --* R</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Wh2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>U</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk102" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk102"><span class="nb">subst</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P --&gt;&gt; Q --* R</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P s h1</span></span></span><br><span><var>Wh2</var><span class="hyp-type"><b>: </b><span>Q s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R s (hunion h1 h2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> H; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk103" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk103">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P ** Q --&gt;&gt; R</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P --&gt;&gt; Q --* R</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> wand_intro; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk104" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk104"><span class="kn">Lemma</span> <span class="nf">wand_imp_l</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">P&#39;</span> <span class="nv">Q</span>,
  (P&#39; --&gt;&gt; P) -&gt; (P --* Q --&gt;&gt; P&#39; --* Q).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">P&#39;</span> <span class="nv">Q</span> : assertion,
P&#39; --&gt;&gt; P -&gt; P --* Q --&gt;&gt; P&#39; --* Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk105" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk105"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">P&#39;</span> <span class="nv">Q</span> : assertion,
P&#39; --&gt;&gt; P -&gt; P --* Q --&gt;&gt; P&#39; --* Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk106" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk106"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, P', Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P&#39; --&gt;&gt; P</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P --* Q --&gt;&gt; P&#39; --* Q</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk107" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk107"><span class="nb">intros</span> s h W h&#39; DISJ P&#39;h&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, P', Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>P&#39; --&gt;&gt; P</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h h&#39;</span></span></span><br><span><var>P'h'</var><span class="hyp-type"><b>: </b><span>P&#39; s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s (hunion h h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> W; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk108" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk108"><span class="kn">Lemma</span> <span class="nf">wand_imp_r</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">Q&#39;</span>,
  (Q --&gt;&gt; Q&#39;) -&gt; (P --* Q --&gt;&gt; P --* Q&#39;).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">Q&#39;</span> : assertion,
Q --&gt;&gt; Q&#39; -&gt; P --* Q --&gt;&gt; P --* Q&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk109" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk109"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">Q&#39;</span> : assertion,
Q --&gt;&gt; Q&#39; -&gt; P --* Q --&gt;&gt; P --* Q&#39;</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk10a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk10a"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, Q'</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q --&gt;&gt; Q&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P --* Q --&gt;&gt; P --* Q&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk10b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk10b"><span class="nb">intros</span> s h W h&#39; DISJ Ph&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, Q'</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Q --&gt;&gt; Q&#39;</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q&#39; s (hunion h h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> H; <span class="nb">apply</span> W; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk10c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk10c"><span class="kn">Lemma</span> <span class="nf">wand_idem</span>: <span class="kr">forall</span> <span class="nv">P</span>,
  emp --&gt;&gt; P --* P.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> : assertion, emp --&gt;&gt; P --* P</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk10d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk10d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> : assertion, emp --&gt;&gt; P --* P</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk10e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk10e"><span class="nb">intros</span> P s h E.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>emp s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P --* P) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk10f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk10f"><span class="nb">rewrite</span> E.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>emp s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P --* P) s hempty</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk110" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk110"><span class="nb">red</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>emp s h</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">h&#39;</span> : heap,
hdisjoint hempty h&#39; -&gt;
P s h&#39; -&gt; P s (hunion hempty h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk111" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk111"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>emp s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hdisjoint hempty h&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s (hunion hempty h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk112" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk112"><span class="nb">rewrite</span> hunion_empty.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>emp s h</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>hdisjoint hempty h&#39;</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P s h&#39;</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk113" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk113"><span class="kn">Lemma</span> <span class="nf">wand_pure_l</span>: <span class="kr">forall</span> (<span class="nv">P</span>: <span class="kt">Prop</span>) <span class="nv">Q</span>,
  P -&gt; (pure P --* Q) = Q.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">P</span> : <span class="kt">Prop</span>) (<span class="nv">Q</span> : assertion),
P -&gt; (pure P --* Q) = Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk114" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk114"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">P</span> : <span class="kt">Prop</span>) (<span class="nv">Q</span> : assertion),
P -&gt; (pure P --* Q) = Q</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk115" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk115"><span class="nb">intros</span> P Q PP.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(pure P --* Q) = Q</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk116" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk116"><span class="nb">apply</span> assertion_extensionality.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">s</span> : store Z) (<span class="nv">h</span> : heap),
(pure P --* Q) s h &lt;-&gt; Q s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk117" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk117"><span class="nb">intros</span> h; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(pure P --* Q) h h0 -&gt; Q h h0</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk118" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk118"><hr></label><div class="goal-conclusion">Q h h0 -&gt; (pure P --* Q) h h0</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk119" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk119">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(pure P --* Q) h h0 -&gt; Q h h0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk11a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk11a"><span class="nb">intros</span> W.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(pure P --* Q) h h0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q h h0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk11b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk11b"><span class="nb">rewrite</span> &lt;- hunion_empty, hunion_comm <span class="bp">by</span> HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(pure P --* Q) h h0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q h (hunion h0 hempty)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk11c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk11c"><span class="nb">apply</span> W.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(pure P --* Q) h h0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h0 hempty</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk11d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(pure P --* Q) h h0</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk11d"><hr></label><div class="goal-conclusion">pure P h hempty</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk11e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk11e">HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(pure P --* Q) h h0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure P h hempty</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">split</span>; <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk11f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk11f">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q h h0 -&gt; (pure P --* Q) h h0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk120" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk120"><span class="nb">intros</span> Qh h&#39; DISJ (Ph&#39; &amp; E).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Qh</var><span class="hyp-type"><b>: </b><span>Q h h0</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>h&#39; = hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q h (hunion h0 h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk121" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk121"><span class="nb">subst</span> h&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Qh</var><span class="hyp-type"><b>: </b><span>Q h h0</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 hempty</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q h (hunion h0 hempty)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk122" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk122"><span class="nb">rewrite</span> hunion_comm, hunion_empty <span class="bp">by</span> HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P</var><span class="hyp-type"><b>: </b><span><span class="kt">Prop</span></span></span></span><br><span><var>Q</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>PP</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Qh</var><span class="hyp-type"><b>: </b><span>Q h h0</span></span></span><br><span><var>DISJ</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 hempty</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q h h0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk123" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk123"><span class="kn">Lemma</span> <span class="nf">wand_curry</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span>,
  (P ** Q --* R) = (P --* Q --* R).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
(P ** Q --* R) = (P --* Q --* R)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk124" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk124"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
(P ** Q --* R) = (P --* Q --* R)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk125" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk125"><span class="nb">intros</span>; <span class="nb">apply</span> assertion_extensionality; <span class="nb">intros</span> h; <span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q --* R) h h0 -&gt; (P --* Q --* R) h h0</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk126" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk126"><hr></label><div class="goal-conclusion">(P --* Q --* R) h h0 -&gt; (P ** Q --* R) h h0</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk127" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk127">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q --* R) h h0 -&gt; (P --* Q --* R) h h0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk128" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk128"><span class="nb">intros</span> W h1 D1 Ph1 h2 D2 Qh2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P ** Q --* R) h h0</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 h1</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h0 h1) h2</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R h (hunion (hunion h0 h1) h2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk129" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk129"><span class="nb">rewrite</span> hunion_assoc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P ** Q --* R) h h0</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 h1</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h0 h1) h2</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R h (hunion h0 (hunion h1 h2))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk12a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk12a"><span class="nb">apply</span> W.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P ** Q --* R) h h0</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 h1</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h0 h1) h2</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h0 (hunion h1 h2)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk12b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P ** Q --* R) h h0</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 h1</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h0 h1) h2</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk12b"><hr></label><div class="goal-conclusion">(P ** Q) h (hunion h1 h2)</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk12c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk12c">HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P ** Q --* R) h h0</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 h1</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h0 h1) h2</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P ** Q) h (hunion h1 h2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk12d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk12d"><span class="kr">exists</span> <span class="nv">h1</span>, h2; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P ** Q --* R) h h0</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D1</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 h1</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D2</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h0 h1) h2</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h1 h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">HDISJ.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk12e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk12e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P --* Q --* R) h h0 -&gt; (P ** Q --* R) h h0</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk12f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk12f"><span class="nb">intros</span> W h&#39; D (h1 &amp; h2 &amp; Ph1 &amp; Qh2 &amp; D12 &amp; U12).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 h&#39;</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>U12</var><span class="hyp-type"><b>: </b><span>h&#39; = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R h (hunion h0 h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk130" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk130"><span class="nb">subst</span> h&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R h (hunion h0 (hunion h1 h2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk131" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk131"><span class="nb">rewrite</span> &lt;- hunion_assoc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">R h (hunion (hunion h0 h1) h2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk132" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk132"><span class="nb">apply</span> W.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h0 h1</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk133" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk133"><hr></label><div class="goal-conclusion">P h h1</div></blockquote><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk134" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk134"><hr></label><div class="goal-conclusion">hdisjoint (hunion h0 h1) h2</div></blockquote><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk135" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk135"><hr></label><div class="goal-conclusion">Q h h2</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk136" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk136">HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">P h h1</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk137" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk137"><hr></label><div class="goal-conclusion">hdisjoint (hunion h0 h1) h2</div></blockquote><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk138" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk138"><hr></label><div class="goal-conclusion">Q h h2</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk139" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk139"><span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint (hunion h0 h1) h2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk13a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk13a"><hr></label><div class="goal-conclusion">Q h h2</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk13b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk13b">HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W</var><span class="hyp-type"><b>: </b><span>(P --* Q --* R) h h0</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h0 (hunion h1 h2)</span></span></span><br><span><var>Ph1</var><span class="hyp-type"><b>: </b><span>P h h1</span></span></span><br><span><var>Qh2</var><span class="hyp-type"><b>: </b><span>Q h h2</span></span></span><br><span><var>D12</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q h h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk13c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk13c"><span class="kn">Lemma</span> <span class="nf">wand_star</span>: <span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span>,
  ((P --* Q) ** R ) --&gt;&gt; (P --* (Q ** R)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
(P --* Q) ** R --&gt;&gt; P --* Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk13d" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk13d"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">P</span> <span class="nv">Q</span> <span class="nv">R</span> : assertion,
(P --* Q) ** R --&gt;&gt; P --* Q ** R</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk13e" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk13e"><span class="nb">intros</span>; <span class="nb">intros</span> s h (h1 &amp; h2 &amp; W1 &amp; R2 &amp; D &amp; U).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h, h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>U</var><span class="hyp-type"><b>: </b><span>h = hunion h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P --* Q ** R) s h</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk13f" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk13f"><span class="nb">subst</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(P --* Q ** R) s (hunion h1 h2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk140" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk140"><span class="nb">intros</span> h&#39; D&#39; Ph&#39;.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(Q ** R) s (hunion (hunion h1 h2) h&#39;)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk141" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk141"><span class="kr">exists</span> (<span class="nv">hunion</span> <span class="nv">h1</span> <span class="nv">h&#39;</span>), h2; <span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Q s (hunion h1 h&#39;)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk142" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk142"><hr></label><div class="goal-conclusion">hdisjoint (hunion h1 h&#39;) h2</div></blockquote><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk143" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk143"><hr></label><div class="goal-conclusion">hunion (hunion h1 h2) h&#39; = hunion (hunion h1 h&#39;) h2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk144" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk144"><span class="nb">apply</span> W1; <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h1 h&#39;</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk145" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk145"><hr></label><div class="goal-conclusion">hdisjoint (hunion h1 h&#39;) h2</div></blockquote><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk146" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk146"><hr></label><div class="goal-conclusion">hunion (hunion h1 h2) h&#39; = hunion (hunion h1 h&#39;) h2</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk147" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk147">HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint (hunion h1 h&#39;) h2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="Separation2-v-chk148" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><label class="goal-separator" for="Separation2-v-chk148"><hr></label><div class="goal-conclusion">hunion (hunion h1 h2) h&#39; = hunion (hunion h1 h&#39;) h2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk149" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk149">HDISJ.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hunion (hunion h1 h2) h&#39; = hunion (hunion h1 h&#39;) h2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk14a" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk14a"><span class="nb">rewrite</span> ! hunion_assoc.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hunion h1 (hunion h2 h&#39;) = hunion h1 (hunion h&#39; h2)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk14b" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk14b"><span class="nb">f_equal</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hunion h2 h&#39; = hunion h&#39; h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="Separation2-v-chk14c" style="display: none" type="checkbox"><label class="alectryon-input" for="Separation2-v-chk14c"><span class="nb">apply</span> hunion_comm.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>P, Q, R</var><span class="hyp-type"><b>: </b><span>assertion</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store Z</span></span></span><br><span><var>h1, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>W1</var><span class="hyp-type"><b>: </b><span>(P --* Q) s h1</span></span></span><br><span><var>R2</var><span class="hyp-type"><b>: </b><span>R s h2</span></span></span><br><span><var>D</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 h2</span></span></span><br><span><var>h'</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>D'</var><span class="hyp-type"><b>: </b><span>hdisjoint (hunion h1 h2) h&#39;</span></span></span><br><span><var>Ph'</var><span class="hyp-type"><b>: </b><span>P s h&#39;</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">hdisjoint h&#39; h2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input">HDISJ.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab6"></a><h2 class="section">Precise assertions</h2>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --></pre><div class="doc">
An assertion is precise if "it unambiguously carves out an area of the heap"
   (in the words of Gotsman, Berdine, Cook, 2011). 
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="c">(*</span>
<span class="c">Definition precise (P: assertion) : Prop :=</span>
<span class="c">  forall h1 h2 h1&#39; h2&#39;,</span>
<span class="c">  hdisjoint h1 h2 -&gt; hdisjoint h1&#39; h2&#39; -&gt; hunion h1 h2 = hunion h1&#39; h2&#39; -&gt;</span>
<span class="c">  P h1 -&gt; P h1&#39; -&gt; h1 = h1&#39;.</span>

<span class="c">(** A parameterized assertion is precise if, in addition, the parameter</span>
<span class="c">   is uniquely determined as well. *)</span>

<span class="c">Definition param_precise {X: Type} (P: X -&gt; assertion) : Prop :=</span>
<span class="c">  forall x1 x2 h1 h2 h1&#39; h2&#39;,</span>
<span class="c">  hdisjoint h1 h2 -&gt; hdisjoint h1&#39; h2&#39; -&gt; hunion h1 h2 = hunion h1&#39; h2&#39; -&gt;</span>
<span class="c">  P x1 h1 -&gt; P x2 h1&#39; -&gt; x1 = x2 /\ h1 = h1&#39;.</span>

<span class="c">Remark param_precise_precise:</span>
<span class="c">  forall (X: Type) (P: X -&gt; assertion),</span>
<span class="c">  param_precise P -&gt; forall x, precise (P x).</span>
<span class="c">Proof.</span>
<span class="c">  intros; red; intros. edestruct (H x x h1 h2 h1&#39; h2&#39;); eauto.</span>
<span class="c">Qed.</span>

<span class="c">Remark precise_param_precise:</span>
<span class="c">  forall P, precise P -&gt; param_precise (fun _ : unit =&gt; P).</span>
<span class="c">Proof.</span>
<span class="c">  intros; red; intros. split. destruct x1, x2; auto. eauto.</span>
<span class="c">Qed.</span>

<span class="c">Lemma pure_precise: forall P,</span>
<span class="c">  precise (pure P).</span>
<span class="c">Proof.</span>
<span class="c">  unfold pure; intros; red; intros. destruct H2, H3. congruence.</span>
<span class="c">Qed.</span>

<span class="c">Lemma pure_param_precise: forall (X: Type) (P: X -&gt; Prop),</span>
<span class="c">  (forall x1 x2, P x1 -&gt; P x2 -&gt; x1 = x2) -&gt;</span>
<span class="c">  param_precise (fun x =&gt; pure (P x)).</span>
<span class="c">Proof.</span>
<span class="c">  unfold pure; intros; red; intros. destruct H3, H4. split. auto. congruence.</span>
<span class="c">Qed. </span>

<span class="c">Lemma contains_param_precise: forall l,</span>
<span class="c">  param_precise (fun v =&gt; contains l v).</span>
<span class="c">Proof.</span>
<span class="c">  unfold contains; intros; red; intros.</span>
<span class="c">  assert (E: hunion h1 h2 l = hunion h1&#39; h2&#39; l) by congruence.</span>
<span class="c">  cbn in E. subst h1 h1&#39;. rewrite ! hupdate_same in E.</span>
<span class="c">  replace x2 with x1 by congruence. auto.</span>
<span class="c">Qed.</span>

<span class="c">Lemma contains_precise: forall l v,</span>
<span class="c">  precise (contains l v).</span>
<span class="c">Proof.</span>
<span class="c">  intros. apply param_precise_precise. apply contains_param_precise.</span>
<span class="c">Qed.</span>

<span class="c">Lemma aexists_precise: forall (X: Type) (P: X -&gt; assertion),</span>
<span class="c">  param_precise P -&gt; precise (aexists P).</span>
<span class="c">Proof.</span>
<span class="c">  intros; red; intros. destruct H3 as (x1 &amp; P1), H4 as (x2 &amp; P2).</span>
<span class="c">  eapply H; eauto.</span>
<span class="c">Qed.</span>

<span class="c">Lemma valid_precise: forall l,</span>
<span class="c">  precise (valid l).</span>
<span class="c">Proof.</span>
<span class="c">  intros. apply aexists_precise. apply contains_param_precise.</span>
<span class="c">Qed.</span>

<span class="c">Lemma sepconj_param_precise: forall (X: Type) (P Q: X -&gt; assertion),</span>
<span class="c">  param_precise P -&gt; (forall x, precise (Q x)) -&gt;</span>
<span class="c">  param_precise (fun x =&gt; P x ** Q x).</span>
<span class="c">Proof.</span>
<span class="c">  intros; red; intros. </span>
<span class="c">  destruct H4 as (h3 &amp; h4 &amp; P3 &amp; Q4 &amp; D &amp; E). </span>
<span class="c">  destruct H5 as (h3&#39; &amp; h4&#39; &amp; P3&#39; &amp; Q4&#39; &amp; D&#39; &amp; E&#39;).</span>
<span class="c">  subst h1 h1&#39;.</span>
<span class="c">  assert (x1 = x2 /\ h3 = h3&#39;). </span>
<span class="c">  { apply H with (hunion h4 h2) (hunion h4&#39; h2&#39;); auto. HDISJ. HDISJ. </span>
<span class="c">    rewrite &lt;- ! hunion_assoc. auto. }</span>
<span class="c">  destruct H4. subst x2.</span>
<span class="c">  assert (h4 = h4&#39;).</span>
<span class="c">  { apply (H0 x1) with (hunion h3 h2) (hunion h3&#39; h2&#39;); auto. HDISJ. HDISJ.</span>
<span class="c">    rewrite &lt;- ! hunion_assoc.</span>
<span class="c">    rewrite (hunion_comm h3) by HDISJ.</span>
<span class="c">    rewrite (hunion_comm h3&#39;) by HDISJ.</span>
<span class="c">    auto.</span>
<span class="c">  }</span>
<span class="c">  subst; auto.</span>
<span class="c">Qed.</span>

<span class="c">Lemma sepconj_precise: forall P Q,</span>
<span class="c">  precise P -&gt; precise Q -&gt; precise (P ** Q).</span>
<span class="c">Proof.</span>
<span class="c">  intros.</span>
<span class="c">  assert (param_precise (fun _ : unit =&gt; P ** Q)).</span>
<span class="c">  { apply sepconj_param_precise. apply precise_param_precise; auto. auto. }</span>
<span class="c">  apply param_precise_precise in H1. auto. exact tt.</span>
<span class="c">Qed.</span>

<span class="c">(** Distributivity laws for precise assertions. *)</span>

<span class="c">Lemma sepconj_and_distr_1: forall P1 P2 Q,</span>
<span class="c">  aand P1 P2 ** Q --&gt;&gt; aand (P1 ** Q) (P2 ** Q).</span>
<span class="c">Proof.</span>
<span class="c">  intros P1 P2 Q h (h1 &amp; h2 &amp; (P11 &amp; P21) &amp; Q2 &amp; D &amp; E); split; exists h1, h2; auto.</span>
<span class="c">Qed.</span>

<span class="c">Lemma sepconj_and_distr_2: forall P1 P2 Q,</span>
<span class="c">  precise Q -&gt;</span>
<span class="c">  aand (P1 ** Q) (P2 ** Q) --&gt;&gt; aand P1 P2 ** Q.</span>
<span class="c">Proof.</span>
<span class="c">  intros P1 P2 Q PQ.</span>
<span class="c">  rewrite (sepconj_comm P1), (sepconj_comm P2). </span>
<span class="c">  intros h ((h1 &amp; h2 &amp; Q1 &amp; P12 &amp; D &amp; E) &amp; (h1&#39; &amp; h2&#39; &amp; Q1&#39; &amp; P22 &amp; D&#39; &amp; E&#39;)).</span>
<span class="c">  assert (h1 = h1&#39;).</span>
<span class="c">  { apply PQ with h2 h2&#39;; auto. HDISJ. HDISJ. congruence. }</span>
<span class="c">  subst h1&#39;.</span>
<span class="c">  assert (h2 = h2&#39;).</span>
<span class="c">  { apply hunion_invert_r with h1; auto; congruence. }</span>
<span class="c">  subst h2&#39;.</span>
<span class="c">  unfold aand; exists h2, h1; intuition auto. HDISJ. rewrite hunion_comm by HDISJ; auto.</span>
<span class="c">Qed.</span>

<span class="c">(** Self-conjunction law for precise assertions. *)</span>

<span class="c">Lemma sepconj_self: forall P,</span>
<span class="c">  precise P -&gt;</span>
<span class="c">  P ** P --&gt;&gt; P.</span>
<span class="c">Proof.</span>
<span class="c">  intros. intros h (h1 &amp; h2 &amp; P1 &amp; P2 &amp; D &amp; E).</span>
<span class="c">  assert (h1 = h2). { apply H with h2 h1; auto. HDISJ. apply hunion_comm; HDISJ. }</span>
<span class="c">  subst h2.</span>
<span class="c">  assert (h = h1). { apply heap_extensionality; intros l. rewrite E; cbn. destruct (h1 l); auto. }</span>
<span class="c">  congruence.</span>
<span class="c">Qed.</span>

<span class="c">*)</span></span></pre></article></body></html>