<!DOCTYPE html>
<html class="alectryon-standalone"><head><title>FlowShallow.v</title><meta charset="utf-8"><meta content="Alectryon" name="generator"><meta name="viewport" content="width=device-width, initial-scale=1"><link href="alectryon.css" rel="stylesheet"><link href="pygments.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" /><script src="alectryon.js"></script></head><body><article class="alectryon-root alectryon-centered alectryon-coqdoc"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.19.0+0.19.3. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+‚Üë</kbd> <kbd>Ctrl+‚Üì</kbd> to navigate, <kbd>Ctrl+üñ±Ô∏è</kbd> to focus. On Mac, use <kbd>‚åò</kbd> instead of <kbd>Ctrl</kbd>.</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk0"><span class="kn">From</span> Coq <span class="kn">Require Import</span> ZArith Lia Bool List String Program.Equality.</label><small class="alectryon-output"><div><div class="alectryon-messages"><blockquote class="alectryon-message">[Loading ML file ring_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file zify_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file micromega_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote><blockquote class="alectryon-message">[Loading ML file btauto_plugin.cmxs (<span class="nb">using</span> legacy method) ... <span class="bp">done</span>]</blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">From</span> CDF <span class="kn">Require Import</span> Common Sequences Separation2 Tactics HeapTactics.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Local</span> <span class="kn">Open Scope</span> string_scope.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp"><span class="c">(* Local Open Scope nat_scope. *)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Local</span> <span class="kn">Open Scope</span> Z_scope.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Local</span> <span class="kn">Open Scope</span> list_scope.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">val</span> := Z.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">expr</span> : <span class="kt">Type</span> :=
  | pvar (x: <span class="kn">ident</span>)
  | pconst (n: val)
  | plet (x: <span class="kn">ident</span>) (e1: expr) (e2: expr)
  <span class="c">(* | pref (x: ident) *)</span>
  <span class="c">(* | pderef (x: ident) *)</span>
  <span class="c">(* | passign (x1: ident) (x2: ident) *)</span>
  | pif (x: <span class="kn">ident</span>) (e1: expr) (e2: expr)
  | pcall (x: <span class="kn">ident</span>) (a: <span class="kn">ident</span>)
  .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">eresult</span> : <span class="kt">Type</span> :=
  | enorm : val -&gt; eresult
.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Reserved Notation</span> <span class="s2">&quot; &#39;eval[&#39; s &#39;,&#39; h &#39;,&#39; e &#39;]&#39; &#39;=&gt;&#39; &#39;[&#39; s1 &#39;,&#39; h1 &#39;,&#39; r &#39;]&#39; &quot;</span> (<span class="kn">at level</span> <span class="mi">50</span>, <span class="kn">left associativity</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">store</span> := store Z.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">bigstep</span> : store -&gt; heap -&gt; expr -&gt; store -&gt; heap -&gt; eresult -&gt; <span class="kt">Prop</span> :=
  | eval_pvar : <span class="kr">forall</span> <span class="nv">s</span> <span class="nv">h</span> <span class="nv">x</span> <span class="nv">v</span>,
    Some v = s x -&gt;
    <span class="kp">eval</span>[ s, h, pvar x ]=&gt;[ s, h, enorm v]
  | eval_pconst : <span class="kr">forall</span> <span class="nv">s</span> <span class="nv">h</span> <span class="nv">x</span>,
    <span class="kp">eval</span>[ s, h, pconst x ] =&gt; [ s, h, enorm x]
  | eval_plet : <span class="kr">forall</span> <span class="nv">x</span> <span class="nv">e1</span> <span class="nv">e2</span> <span class="nv">v</span> <span class="nv">s</span> <span class="nv">h</span> <span class="nv">h2</span> <span class="nv">s2</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">r</span>,
    <span class="kp">eval</span>[ s, h, e1 ] =&gt; [ s1, h1, enorm v] -&gt;
    <span class="kp">eval</span>[ supdate x v s1, h1, e2 ] =&gt; [ s2, h2, r] -&gt;
    <span class="kp">eval</span>[ s, h, plet x e1 e2 ] =&gt; [ s2, h2, r ]
  <span class="c">(* | eval_pref : forall x s (h:heap) l,</span>
<span class="c">    h l = None -&gt;</span>
<span class="c">    eval[ s, h, pref x ] =&gt; [ s, hupdate l (s x) h, enorm l]</span>
<span class="c">  | eval_deref : forall x s (h:heap) v,</span>
<span class="c">    h (s x) = Some v -&gt;</span>
<span class="c">    eval[ s, h, pderef x ] =&gt; [ s, h, enorm v]</span>
<span class="c">  | eval_assign : forall x1 x2 s h,</span>
<span class="c">    eval[ s, h, passign x1 x2 ] =&gt; [ s, hupdate (s x1) (s x2) h, enorm 0] *)</span>

  <span class="kn">where</span> <span class="s2">&quot; &#39;eval[&#39; s &#39;,&#39; h &#39;,&#39; e &#39;]&#39; &#39;=&gt;&#39; &#39;[&#39; s1 &#39;,&#39; h1 &#39;,&#39; r &#39;]&#39; &quot;</span> := (bigstep s h e s1 h1 r)
.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Module</span> <span class="nf">ProgramExamples</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="c">(* Example ex_ref :</span>
<span class="c">    eval[ sempty, hempty, plet &quot;x&quot; (pconst 1) (pref &quot;x&quot;) ]=&gt;[ sempty, hupdate 2 1 hempty, enorm 2 ].</span>
<span class="c">  Proof.</span>
<span class="c">    apply eval_plet with (v:=1) (s1:=sempty) (s2:=supdate &quot;x&quot; 1 sempty) (h1:=hempty).</span>
<span class="c">    apply eval_pconst.</span>
<span class="c">    apply eval_pref.</span>
<span class="c">    constructor.</span>
<span class="c">  Qed. *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">ProgramExamples</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">precond</span> := assertion.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">postcond</span> := Z -&gt; assertion.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">result</span> : <span class="kt">Type</span> :=
  | norm : Z -&gt; result.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">compatible</span> <span class="nv">r1</span> <span class="nv">r2</span> :=
    <span class="kr">match</span> (r1, r2) <span class="kr">with</span>
    | (norm r3, enorm r4) =&gt; r3 = r4
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">flow</span> := store -&gt; heap -&gt; store -&gt; heap -&gt; result -&gt; <span class="kt">Prop</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">req</span> : precond -&gt; flow := <span class="kr">fun</span> <span class="nv">p</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">r</span> =&gt;
  s1 = s2 /\
  <span class="c">(* h3 is the piece taken out satisfying p *)</span>
  <span class="kr">exists</span> <span class="nv">h3</span>, h1 = hunion h2 h3 /\ hdisjoint h2 h3 /\ p s1 h3.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* TODO only true case for now *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">ens</span> : postcond -&gt; flow := <span class="kr">fun</span> <span class="nv">q</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">r</span> =&gt;
  s1 = s2 /\
  <span class="c">(* forall v, r = norm v -&gt; *)</span>
  <span class="kr">exists</span> <span class="nv">v</span>, r = norm v /\
  <span class="c">(* h3 is the piece satisfying q that is addded to h1 *)</span>
    <span class="kr">exists</span> <span class="nv">h3</span>, h2 = hunion h1 h3 /\ hdisjoint h1 h3 /\ q v s1 h3.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">seq</span> : flow -&gt; flow -&gt; flow := <span class="kr">fun</span> <span class="nv">f1</span> <span class="nv">f2</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">r</span> =&gt;
  <span class="kr">exists</span> <span class="nv">s3</span> <span class="nv">h3</span> <span class="nv">r1</span>,
  f1 s1 h1 s3 h3 r1 /\
  f2 s3 h3 s2 h2 r.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Infix</span> <span class="s2">&quot;;;&quot;</span> := seq (<span class="kn">at level</span> <span class="mi">80</span>, <span class="kn">right associativity</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* we can&#39;t use hoas for this as the existential binding has to appear in the stack *)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">fexists</span> : <span class="kn">ident</span> -&gt; flow -&gt; flow := <span class="kr">fun</span> <span class="nv">i</span> <span class="nv">f</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">r</span> =&gt;
  s1 i = None /\
  <span class="kr">exists</span> <span class="nv">v</span>,
    f (supdate i v s1) h1 s2 h2 r.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">replace_ret</span> (<span class="nv">x</span>:ident) (<span class="nv">f</span>:flow) : flow := <span class="kr">fun</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">r</span> =&gt;
  <span class="kr">exists</span> <span class="nv">v</span>, Some v = s1 x /\
  f s1 h1 s2 h2 (norm v).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">empty</span> := ens (<span class="kr">fun</span> <span class="nv">r</span> =&gt; pure <span class="kt">True</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* For reasoning forward from flows in the context *)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">fstep</span> :=
  <span class="kr">match goal with</span>
  | H : seq _ _ _ _ _ _ _ |- _ =&gt; <span class="nb">unfold</span> seq <span class="kr">in</span> H; destr H
  | H : req _ _ _ _ _ _ |- _ =&gt; <span class="nb">unfold</span> req <span class="kr">in</span> H; destr H; <span class="nb">subst</span>
  | H : ens _ _ _ _ _ _ |- _ =&gt; <span class="nb">unfold</span> ens <span class="kr">in</span> H; destr H; <span class="nb">subst</span>
  | H : pureconj _ _ _ _ |- _ =&gt; <span class="nb">unfold</span> pureconj <span class="kr">in</span> H; destr H; <span class="nb">subst</span>
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Ltac</span> <span class="nf">fsteps</span> :=
  <span class="kr">match goal with</span>
  | H : seq _ _ _ _ _ _ _ |- _ =&gt; fstep; fsteps
  | H : req _ _ _ _ _ _ |- _ =&gt; fstep; fsteps
  | H : ens _ _ _ _ _ _ |- _ =&gt; fstep; fsteps
  | H : pureconj _ _ _ _ |- _ =&gt; fstep; fsteps
  | _ =&gt; <span class="kp">idtac</span>
  <span class="kr">end</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* Definition satisfies s1 h1 s2 h2 r (f:flow) := f s1 h1 s2 h2 r. *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk1"><span class="kn">Lemma</span> <span class="nf">empty_noop</span> : <span class="kr">forall</span> <span class="nv">s</span> <span class="nv">h</span> <span class="nv">r</span>,
  empty s h s h (norm r).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">s</span> : store) (<span class="nv">h</span> : heap) (<span class="nv">r</span> : Z),
empty s h s h (norm r)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk2"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">s</span> : store) (<span class="nv">h</span> : heap) (<span class="nv">r</span> : Z),
empty s h s h (norm r)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk3" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk3"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">empty s h s h (norm r)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk4" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk4"><span class="nb">unfold</span> empty.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">ens (<span class="kr">fun</span> <span class="nv">_</span> : Z =&gt; pure <span class="kt">True</span>) s h s h (norm r)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk5"><span class="nb">unfold</span> ens.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s = s /\
(<span class="kr">exists</span> <span class="nv">v</span> : Z,
   norm r = norm v /\
   (<span class="kr">exists</span> <span class="nv">h3</span> : heap,
      h = hunion h h3 /\
      hdisjoint h h3 /\ pure <span class="kt">True</span> s h3))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk6"><span class="nb">intuition</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">v</span> : Z,
  norm r = norm v /\
  (<span class="kr">exists</span> <span class="nv">h3</span> : heap,
     h = hunion h h3 /\
     hdisjoint h h3 /\ pure <span class="kt">True</span> s h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk7"><span class="kr">exists</span> <span class="nv">r</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">norm r = norm r /\
(<span class="kr">exists</span> <span class="nv">h3</span> : heap,
   h = hunion h h3 /\ hdisjoint h h3 /\ pure <span class="kt">True</span> s h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk8"><span class="nb">intuition</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">h3</span> : heap,
  h = hunion h h3 /\ hdisjoint h h3 /\ pure <span class="kt">True</span> s h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk9"><span class="kr">exists</span> <span class="nv">hempty</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h = hunion h hempty /\
hdisjoint h hempty /\ pure <span class="kt">True</span> s hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka"><span class="nb">intuition</span> heap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">pure <span class="kt">True</span> s hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkb"><span class="nb">unfold</span> pure.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kt">True</span> /\ hempty = hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intuition</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Module</span> <span class="nf">SemanticsExamples</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">f1</span> : flow := ens (<span class="kr">fun</span> <span class="nv">r</span> =&gt; pure (r=<span class="mi">1</span>)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">f2</span> : flow := req (<span class="kr">fun</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; s <span class="s2">&quot;x&quot;</span> = Some <span class="mi">1</span>).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="c">(* ex z; req x-&gt;z; ens[r] x-&gt;1/\r=1 *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">f3</span> : flow :=
    fexists <span class="s2">&quot;z&quot;</span> (req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>) ;; ens (<span class="kr">fun</span> <span class="nv">r</span> =&gt; (r=<span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkc"><span class="kn">Example</span> <span class="nf">ex_sem_f1</span>:
    f1 sempty hempty sempty hempty (norm <span class="mi">1</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">f1 sempty hempty sempty hempty (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    <span class="c">(* sem[true, sempty, hempty]=&gt;[true, sempty, hempty, norm(1)] |= f1. *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkd"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">f1 sempty hempty sempty hempty (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chke"><span class="nb">unfold</span> f1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; pure (r = <span class="mi">1</span>)) sempty hempty sempty
  hempty (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkf"><span class="nb">unfold</span> ens.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">sempty = sempty /\
(<span class="kr">exists</span> <span class="nv">v</span> : Z,
   norm <span class="mi">1</span> = norm v /\
   (<span class="kr">exists</span> <span class="nv">h3</span> : heap,
      hempty = hunion hempty h3 /\
      hdisjoint hempty h3 /\ pure (v = <span class="mi">1</span>) sempty h3))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk10" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk10"><span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">v</span> : Z,
  norm <span class="mi">1</span> = norm v /\
  (<span class="kr">exists</span> <span class="nv">h3</span> : heap,
     hempty = hunion hempty h3 /\
     hdisjoint hempty h3 /\ pure (v = <span class="mi">1</span>) sempty h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk11"><span class="kr">exists</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">norm <span class="mi">1</span> = norm <span class="mi">1</span> /\
(<span class="kr">exists</span> <span class="nv">h3</span> : heap,
   hempty = hunion hempty h3 /\
   hdisjoint hempty h3 /\ pure (<span class="mi">1</span> = <span class="mi">1</span>) sempty h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk12"><span class="nb">intuition</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">h3</span> : heap,
  hempty = hunion hempty h3 /\
  hdisjoint hempty h3 /\ pure (<span class="mi">1</span> = <span class="mi">1</span>) sempty h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk13"><span class="kr">exists</span> <span class="nv">hempty</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">hempty = hunion hempty hempty /\
hdisjoint hempty hempty /\ pure (<span class="mi">1</span> = <span class="mi">1</span>) sempty hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk14">heap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">pure (<span class="mi">1</span> = <span class="mi">1</span>) sempty hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk15"><span class="nb">unfold</span> pure.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">1</span> = <span class="mi">1</span> /\ hempty = hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intuition</span> <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk16"><span class="kn">Example</span> <span class="nf">ex_sem_f3</span>:
    f3 (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty) 
      (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">f3 (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk17"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">f3 (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk18" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk18"><span class="nb">unfold</span> f3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">fexists <span class="s2">&quot;z&quot;</span>
  (req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>);;
   ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>))
  (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk19" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk19"><span class="nb">unfold</span> fexists.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty <span class="s2">&quot;z&quot;</span> = None /\
(<span class="kr">exists</span> <span class="nv">v</span> : Z,
   (req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>);;
    ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>))
     (supdate <span class="s2">&quot;z&quot;</span> v (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
     (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
     (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
     (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk1a"><span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">v</span> : Z,
  (req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>);;
   ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>))
    (supdate <span class="s2">&quot;z&quot;</span> v (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk1b" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk1b"><span class="kr">exists</span> <span class="mi">3</span>. <span class="c">(* the initial value of z in ex z. x-&gt;z, which is given *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">(req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>);;
 ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>))
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk1c" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk1c"><span class="nb">unfold</span> seq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> (<span class="nv">s3</span> : store) (<span class="nv">h3</span> : heap) (<span class="nv">r1</span> : result),
  req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty) s3 h3 r1 /\
  ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>) s3 h3
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk1d" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk1d"><span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> (<span class="nv">s3</span> : store) (<span class="nv">h3</span> : heap) (<span class="nv">r1</span> : result),
  req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty) s3 h3 r1 /\
  ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>) s3 h3
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk1e" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk1e"><span class="kr">exists</span> (<span class="nv">supdate</span> <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> (<span class="nv">h3</span> : heap) (<span class="nv">r1</span> : result),
  req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) h3 r1 /\
  ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) h3
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk1f" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk1f"><span class="kr">exists</span> <span class="nv">hempty</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">r1</span> : result,
  req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) hempty r1 /\
  ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) hempty
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk20"><span class="kr">exists</span> (<span class="nv">norm</span> <span class="mi">5</span>). <span class="c">(* ret of req, can be anything *)</span></label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) hempty
  (norm <span class="mi">5</span>) /\
ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) hempty
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk21"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) hempty
  (norm <span class="mi">5</span>)</div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) hempty
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk22">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">req (pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span>)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) hempty
  (norm <span class="mi">5</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk23" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk23"><span class="nb">unfold</span> req.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) =
supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) /\
(<span class="kr">exists</span> <span class="nv">h3</span> : heap,
   hupdate <span class="mi">2</span> <span class="mi">3</span> hempty = hunion hempty h3 /\
   hdisjoint hempty h3 /\
   pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span> (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
     h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk24" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk24"><span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">h3</span> : heap,
  hupdate <span class="mi">2</span> <span class="mi">3</span> hempty = hunion hempty h3 /\
  hdisjoint hempty h3 /\
  pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span> (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk25" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk25"><span class="kr">exists</span> (<span class="nv">hupdate</span> <span class="mi">2</span> <span class="mi">3</span> <span class="nv">hempty</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">hupdate <span class="mi">2</span> <span class="mi">3</span> hempty =
hunion hempty (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty) /\
hdisjoint hempty (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty) /\
pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span> (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk26">heap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">pts <span class="s2">&quot;x&quot;</span> <span class="s2">&quot;z&quot;</span> (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk27"><span class="nb">unfold</span> pts.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">v</span> <span class="nv">w</span> : Z,
  Some v = supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) <span class="s2">&quot;x&quot;</span> /\
  Some w = supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) <span class="s2">&quot;z&quot;</span> /\
  contains v w (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">3</span> hempty)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk28"><span class="nb">unfold</span> contains.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">v</span> <span class="nv">w</span> : Z,
  Some v = supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) <span class="s2">&quot;x&quot;</span> /\
  Some w = supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) <span class="s2">&quot;z&quot;</span> /\
  hupdate <span class="mi">2</span> <span class="mi">3</span> hempty = hupdate v w hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk29" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk29"><span class="nb">rewrite</span> supdate_other; <span class="kp">try</span> <span class="bp">congruence</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">v</span> <span class="nv">w</span> : Z,
  Some v = supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty <span class="s2">&quot;x&quot;</span> /\
  Some w = supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) <span class="s2">&quot;z&quot;</span> /\
  hupdate <span class="mi">2</span> <span class="mi">3</span> hempty = hupdate v w hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk2a" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk2a"><span class="nb">rewrite</span> supdate_same.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">v</span> <span class="nv">w</span> : Z,
  Some v = Some <span class="mi">2</span> /\
  Some w = supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) <span class="s2">&quot;z&quot;</span> /\
  hupdate <span class="mi">2</span> <span class="mi">3</span> hempty = hupdate v w hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk2b" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk2b"><span class="nb">rewrite</span> supdate_same.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">v</span> <span class="nv">w</span> : Z,
  Some v = Some <span class="mi">2</span> /\
  Some w = Some <span class="mi">3</span> /\
  hupdate <span class="mi">2</span> <span class="mi">3</span> hempty = hupdate v w hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk2c" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk2c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">ens (<span class="kr">fun</span> <span class="nv">r</span> : Z =&gt; (r = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) hempty
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) (norm <span class="mi">1</span>)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk2d" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk2d"><span class="nb">unfold</span> ens.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) =
supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) /\
(<span class="kr">exists</span> <span class="nv">v</span> : Z,
   norm <span class="mi">1</span> = norm v /\
   (<span class="kr">exists</span> <span class="nv">h3</span> : heap,
      hupdate <span class="mi">2</span> <span class="mi">1</span> hempty = hunion hempty h3 /\
      hdisjoint hempty h3 /\
      ((v = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
        (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) h3))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk2e" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk2e"><span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">v</span> : Z,
  norm <span class="mi">1</span> = norm v /\
  (<span class="kr">exists</span> <span class="nv">h3</span> : heap,
     hupdate <span class="mi">2</span> <span class="mi">1</span> hempty = hunion hempty h3 /\
     hdisjoint hempty h3 /\
     ((v = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
       (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk2f" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk2f"><span class="kr">exists</span> <span class="mi">1</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">norm <span class="mi">1</span> = norm <span class="mi">1</span> /\
(<span class="kr">exists</span> <span class="nv">h3</span> : heap,
   hupdate <span class="mi">2</span> <span class="mi">1</span> hempty = hunion hempty h3 /\
   hdisjoint hempty h3 /\
   ((<span class="mi">1</span> = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
     (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) h3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk30" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk30"><span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">h3</span> : heap,
  hupdate <span class="mi">2</span> <span class="mi">1</span> hempty = hunion hempty h3 /\
  hdisjoint hempty h3 /\
  ((<span class="mi">1</span> = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
    (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty)) h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk31" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk31"><span class="kr">exists</span> (<span class="nv">hupdate</span> <span class="mi">2</span> <span class="mi">1</span> <span class="nv">hempty</span>).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">hupdate <span class="mi">2</span> <span class="mi">1</span> hempty =
hunion hempty (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) /\
hdisjoint hempty (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty) /\
((<span class="mi">1</span> = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk32" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk32">heap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">((<span class="mi">1</span> = <span class="mi">1</span>) //\\ ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span>)
  (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk33" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk33"><span class="nb">unfold</span> pureconj.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="mi">1</span> = <span class="mi">1</span> /\
ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span> (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk34" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk34"><span class="nb">intuition</span> <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">ptsval <span class="s2">&quot;x&quot;</span> <span class="mi">1</span> (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
  (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk35" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk35"><span class="nb">unfold</span> ptsval.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">w</span> : Z,
  Some w = supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) <span class="s2">&quot;x&quot;</span> /\
  contains w <span class="mi">1</span> (supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty))
    (hupdate <span class="mi">2</span> <span class="mi">1</span> hempty)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk36" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk36"><span class="nb">unfold</span> contains.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">w</span> : Z,
  Some w = supdate <span class="s2">&quot;z&quot;</span> <span class="mi">3</span> (supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty) <span class="s2">&quot;x&quot;</span> /\
  hupdate <span class="mi">2</span> <span class="mi">1</span> hempty = hupdate w <span class="mi">1</span> hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk37" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk37"><span class="nb">rewrite</span> supdate_other; <span class="kp">try</span> <span class="bp">congruence</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">w</span> : Z,
  Some w = supdate <span class="s2">&quot;x&quot;</span> <span class="mi">2</span> sempty <span class="s2">&quot;x&quot;</span> /\
  hupdate <span class="mi">2</span> <span class="mi">1</span> hempty = hupdate w <span class="mi">1</span> hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk38" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk38"><span class="nb">rewrite</span> supdate_same.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">w</span> : Z,
  Some w = Some <span class="mi">2</span> /\
  hupdate <span class="mi">2</span> <span class="mi">1</span> hempty = hupdate w <span class="mi">1</span> hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">SemanticsExamples</span>.</span></span></pre><div class="doc">
<a id="lab1"></a><h1 class="section">Hoare rules</h1>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp"><span class="c">(* forward rules say how to produce a staged formula from a program *)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Inductive</span> <span class="nf">forward</span> : expr -&gt; flow -&gt; <span class="kt">Prop</span> :=
  | fw_const: <span class="kr">forall</span> <span class="nv">n</span>,
    forward (pconst n) (ens (<span class="kr">fun</span> <span class="nv">res</span> =&gt; (res = n) //\\ emp))

  | fw_var: <span class="kr">forall</span> <span class="nv">x</span> <span class="nv">v</span>,
    forward (pvar x) (ens (<span class="kr">fun</span> <span class="nv">res</span> <span class="nv">s</span> <span class="nv">h</span> =&gt; s x = Some v /\ res = v /\ emp s h))

  <span class="c">(* | fw_deref: forall x y,</span>
<span class="c">    forward (pderef x) (fexists y (req (pts x y);;</span>
<span class="c">      ens (fun res s h =&gt; ((res = s y) //\\ pts x y) s h)))</span>

<span class="c">  | fw_ref: forall x y,</span>
<span class="c">    (* forward (pref x) (fexists (fun y =&gt; ens (fun r s h =&gt; contains y (s x) s h))) *)</span>
<span class="c">    forward (pref x) (fexists y (ens (fun r s h =&gt; (r = s y) /\ (pts y x s h)))) *)</span>

  | fw_let: <span class="kr">forall</span> <span class="nv">x</span> <span class="nv">e1</span> <span class="nv">e2</span> <span class="nv">f1</span> <span class="nv">f2</span> <span class="nv">f3</span>,
    forward e1 f1 -&gt;
    forward e2 f2 -&gt;
    replace_ret x f1 = f3 -&gt;
    forward (plet x e1 e2) (fexists x (f3 ;; f2))

  <span class="c">(* | fw_get: forall l v, </span>
<span class="c">    forward (GET l)</span>
<span class="c">      (req (contains l v) ;;</span>
<span class="c">      (ens (fun r =&gt; (r = v) //\\ contains l v))) *)</span>
.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">ForwardExamples</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="c">(* let x = 1 in x *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk39" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk39"><span class="kn">Example</span> <span class="nf">ex_forward_let1</span>:
    <span class="kr">exists</span> <span class="nv">st</span>, forward (plet <span class="s2">&quot;x&quot;</span> (pconst <span class="mi">1</span>) (pvar <span class="s2">&quot;x&quot;</span>)) st.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">st</span> : flow,
  forward (plet <span class="s2">&quot;x&quot;</span> (pconst <span class="mi">1</span>) (pvar <span class="s2">&quot;x&quot;</span>)) st</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk3a" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk3a"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">exists</span> <span class="nv">st</span> : flow,
  forward (plet <span class="s2">&quot;x&quot;</span> (pconst <span class="mi">1</span>) (pvar <span class="s2">&quot;x&quot;</span>)) st</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk3b" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk3b"><span class="nb">eexists</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">forward (plet <span class="s2">&quot;x&quot;</span> (pconst <span class="mi">1</span>) (pvar <span class="s2">&quot;x&quot;</span>)) <span class="nl">?st</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk3c" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk3c"><span class="nb">eapply</span> fw_let.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">forward (pconst <span class="mi">1</span>) <span class="nl">?f1</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">forward (pvar <span class="s2">&quot;x&quot;</span>) <span class="nl">?f2</span></div></blockquote><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">replace_ret <span class="s2">&quot;x&quot;</span> <span class="nl">?f1</span> = <span class="nl">?f3</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk3d" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk3d"><span class="nb">eapply</span> fw_const.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">forward (pvar <span class="s2">&quot;x&quot;</span>) <span class="nl">?f2</span></div></blockquote><div class="alectryon-extra-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">replace_ret <span class="s2">&quot;x&quot;</span>
  (ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = <span class="mi">1</span>) //\\ emp)) = <span class="nl">?f3</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk3e" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk3e"><span class="nb">eapply</span> fw_var.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">replace_ret <span class="s2">&quot;x&quot;</span>
  (ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = <span class="mi">1</span>) //\\ emp)) = <span class="nl">?f3</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk3f" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk3f"><span class="kn">Unshelve</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion">Z</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> <span class="mi">3</span>. <span class="c">(* anything is allowed it seems *)</span></span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="c">(* Check ex_intro. *)</span>
  <span class="c">(* ex_intro : forall (A : Type) (P : A -&gt; Prop) (x : A), P x -&gt; exists y, P y *)</span>
  <span class="c">(* Print ex_forward_let1. *)</span>
    <span class="c">(* (fun st : ...) is P *)</span>
    <span class="c">(* (fexists &quot;x&quot; ...) is the witness x, which is what we are after *)</span>
    <span class="c">(* (fw_let &quot;x&quot; ...) is the existential stmt P x, which is a derivation using the rules above, whose type includes the witness *)</span>

</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">ForwardExamples</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">wellformed</span> (<span class="nv">f</span>:flow) <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">r</span> :=
  <span class="c">(* satisfies s1 h1 s2 h2 r f -&gt; substore s1 s2. *)</span>
  f s1 h1 s2 h2 r -&gt; substore s1 s2.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk40" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk40"><span class="kn">Lemma</span> <span class="nf">replace_ret_wellformed</span> : <span class="kr">forall</span> <span class="nv">x</span> <span class="nv">f</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">v</span>,
  Some v = s1 x -&gt;
  wellformed f s1 h1 s2 h2 (norm v) -&gt;
  (wellformed (replace_ret x f)) s1 h1 s2 h2 (norm v).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">x</span> : ident) (<span class="nv">f</span> : flow) (<span class="nv">s1</span> : ident -&gt; option Z)
  (<span class="nv">h1</span> : heap) (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) (<span class="nv">v</span> : Z),
Some v = s1 x -&gt;
wellformed f s1 h1 s2 h2 (norm v) -&gt;
wellformed (replace_ret x f) s1 h1 s2 h2 (norm v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk41" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk41"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">x</span> : ident) (<span class="nv">f</span> : flow) (<span class="nv">s1</span> : ident -&gt; option Z)
  (<span class="nv">h1</span> : heap) (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) (<span class="nv">v</span> : Z),
Some v = s1 x -&gt;
wellformed f s1 h1 s2 h2 (norm v) -&gt;
wellformed (replace_ret x f) s1 h1 s2 h2 (norm v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk42" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk42"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s1 x</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>wellformed f s1 h1 s2 h2 (norm v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">wellformed (replace_ret x f) s1 h1 s2 h2 (norm v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk43" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk43"><span class="nb">unfold</span> wellformed.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s1 x</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>wellformed f s1 h1 s2 h2 (norm v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">replace_ret x f s1 h1 s2 h2 (norm v) -&gt; substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk44" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk44"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s1 x</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>wellformed f s1 h1 s2 h2 (norm v)</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>replace_ret x f s1 h1 s2 h2 (norm v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* unfold satisfies in H1. *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk45" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk45"><span class="nb">unfold</span> replace_ret <span class="kr">in</span> H1; destr H1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s1 x</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>wellformed f s1 h1 s2 h2 (norm v)</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Some H2 = s1 x</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>f s1 h1 s2 h2 (norm H2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk46" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk46"><span class="nb">apply</span> H0.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s1 x</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>wellformed f s1 h1 s2 h2 (norm v)</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Some H2 = s1 x</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>f s1 h1 s2 h2 (norm H2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f s1 h1 s2 h2 (norm v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* unfolds. *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* we could prove _wellformed lemmas for all req, ens, etc., but currently we&#39;re doing it only for the structures generated from the forward rules *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk47" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk47"><span class="kn">Lemma</span> <span class="nf">forward_wellformed</span> : <span class="kr">forall</span> <span class="nv">e</span> <span class="nv">f</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">r</span>,
forward e f -&gt; (wellformed f) s1 h1 s2 h2 r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">e</span> : expr) (<span class="nv">f</span> : flow) (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) (<span class="nv">r</span> : result),
forward e f -&gt; wellformed f s1 h1 s2 h2 r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk48" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk48"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">e</span> : expr) (<span class="nv">f</span> : flow) (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) (<span class="nv">r</span> : result),
forward e f -&gt; wellformed f s1 h1 s2 h2 r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk49" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk49"><span class="nb">intros</span> e f s1 h1 s2 h2 r H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>e</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e f</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">wellformed f s1 h1 s2 h2 r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk4a" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk4a"><span class="nb">revert</span> s1 h1 s2 h2 r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>e</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e f</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap) (<span class="nv">s2</span> : store)
  (<span class="nv">h2</span> : heap) (<span class="nv">r</span> : result), wellformed f s1 h1 s2 h2 r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk4b" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk4b"><span class="nb">induction</span> H; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">wellformed (ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp))
  s1 h1 s2 h2 r</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="FlowShallow-v-chk4c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br></div><label class="goal-separator" for="FlowShallow-v-chk4c"><hr></label><div class="goal-conclusion">wellformed
  (ens
     (<span class="kr">fun</span> (<span class="nv">res</span> : Z) (<span class="nv">s</span> : Common.store Z) (<span class="nv">h</span> : heap) =&gt;
      s x = Some v /\ res = v /\ emp s h)) s1 h1 s2 h2
  r</div></blockquote><input class="alectryon-extra-goal-toggle" id="FlowShallow-v-chk4d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2, f3</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 = f3</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br></div><label class="goal-separator" for="FlowShallow-v-chk4d"><hr></label><div class="goal-conclusion">wellformed (fexists x (f3;; f2)) s1 h1 s2 h2 r</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk4e" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk4e">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">wellformed (ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp))
  s1 h1 s2 h2 r</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk4f" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk4f"><span class="nb">unfold</span> wellformed; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp) s1 h1 s2
  h2 r</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk50" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk50"><span class="nb">unfold</span> ens <span class="kr">in</span> H; destr H; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 H2</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>((H = n) //\\ emp) s2 H2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> substore_refl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk51" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk51">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">wellformed
  (ens
     (<span class="kr">fun</span> (<span class="nv">res</span> : Z) (<span class="nv">s</span> : Common.store Z) (<span class="nv">h</span> : heap) =&gt;
      s x = Some v /\ res = v /\ emp s h)) s1 h1 s2 h2
  r</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk52" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk52"><span class="nb">unfold</span> wellformed; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>ens
  (<span class="kr">fun</span> (<span class="nv">res</span> : Z) (<span class="nv">s</span> : Common.store Z) (<span class="nv">h</span> : heap)
   =&gt; s x = Some v /\ res = v /\ emp s h) s1 h1 s2
  h2 r</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk53" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk53"><span class="nb">unfold</span> ens <span class="kr">in</span> H; destr H; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>hdisjoint h1 H2</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>s2 x = Some v</span></span></span><br><span><var>H8</var><span class="hyp-type"><b>: </b><span>emp s2 H2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> substore_refl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk54" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk54">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2, f3</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 = f3</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">wellformed (fexists x (f3;; f2)) s1 h1 s2 h2 r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk55" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk55"><span class="nb">unfold</span> wellformed; <span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2, f3</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 = f3</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>fexists x (f3;; f2) s1 h1 s2 h2 r</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk56" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk56"><span class="nb">unfold</span> fexists <span class="kr">in</span> H2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2, f3</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 = f3</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None /\
(<span class="kr">exists</span> <span class="nv">v</span> : Z,
   (f3;; f2) (supdate x v s1) h1 s2 h2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk57" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk57"><span class="nb">destruct</span> H2 <span class="kr">as</span> [? [v H5]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2, f3</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 = f3</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>(f3;; f2) (supdate x v s1) h1 s2 h2 r</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk58" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk58"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>(replace_ret x f1;; f2) 
  (supdate x v s1) h1 s2 h2 r</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk59" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk59"><span class="nb">unfold</span> seq <span class="kr">in</span> H5.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> (<span class="nv">s3</span> : store) (<span class="nv">h3</span> : heap) 
(<span class="nv">r1</span> : result),
  replace_ret x f1 (supdate x v s1) h1 s3 h3 r1 /\
  f2 s3 h3 s2 h2 r</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk5a" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk5a"><span class="nb">destruct</span> H5 <span class="kr">as</span> [s3 [h3 [? [Hrr Hf2]]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk5b" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk5b"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="c">(* introduce well-formed lemma on replace_ret *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk5c" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk5c"><span class="nb">pose proof</span> (replace_ret_wellformed x f1 (supdate x v s1) h1 s3 h3 v) <span class="kr">as</span> Hret.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>Some v = supdate x v s1 x -&gt;
wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v) -&gt;
wellformed (replace_ret x f1) 
  (supdate x v s1) h1 s3 h3 
  (norm v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk5d" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk5d"><span class="nb">rewrite</span> supdate_same <span class="kr">in</span> Hret.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>Some v = Some v -&gt;
wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v) -&gt;
wellformed (replace_ret x f1) 
  (supdate x v s1) h1 s3 h3 
  (norm v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk5e" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk5e"><span class="nb">assert</span> (Some v = Some v) <span class="kr">as</span> triv.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>Some v = Some v -&gt;
wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v) -&gt;
wellformed (replace_ret x f1) 
  (supdate x v s1) h1 s3 h3 
  (norm v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some v = Some v</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="FlowShallow-v-chk5f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>Some v = Some v -&gt;
wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v) -&gt;
wellformed (replace_ret x f1) 
  (supdate x v s1) h1 s3 h3 
  (norm v)</span></span></span><br><span><var>triv</var><span class="hyp-type"><b>: </b><span>Some v = Some v</span></span></span><br></div><label class="goal-separator" for="FlowShallow-v-chk5f"><hr></label><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk60" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk60"><span class="bp">reflexivity</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>Some v = Some v -&gt;
wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v) -&gt;
wellformed (replace_ret x f1) 
  (supdate x v s1) h1 s3 h3 
  (norm v)</span></span></span><br><span><var>triv</var><span class="hyp-type"><b>: </b><span>Some v = Some v</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk61" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk61"><span class="nb">specialize</span> (Hret triv); <span class="nb">clear</span> triv.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f1 s1 h1 s2 h2 r</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v) -&gt;
wellformed (replace_ret x f1) 
  (supdate x v s1) h1 s3 h3 
  (norm v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
  <span class="c">(* assuming f1 is wf using the IH, replace_ret f1 is wf *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk62" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk62"><span class="nb">specialize</span> (IHforward1 (supdate x v s1) h1 s3 h3 (norm v)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v)</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v) -&gt;
wellformed (replace_ret x f1) 
  (supdate x v s1) h1 s3 h3 
  (norm v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk63" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk63"><span class="nb">specialize</span> (Hret IHforward1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v)</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>wellformed (replace_ret x f1) 
  (supdate x v s1) h1 s3 h3 
  (norm v)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk64" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk64"><span class="nb">unfold</span> wellformed <span class="kr">in</span> Hret.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v)</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3
  (norm v) -&gt; substore (supdate x v s1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk65" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk65"><span class="nb">specialize</span> (Hret Hrr).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v)</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
wellformed f2 s1 h1 s2 h2 r</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk66" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk66"><span class="nb">unfold</span> wellformed <span class="kr">in</span> IHforward2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v)</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) 
  (<span class="nv">r</span> : result),
f2 s1 h1 s2 h2 r -&gt; substore s1 s2</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk67" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk67"><span class="nb">specialize</span> (IHforward2 s3 h3 s2 h2 r Hf2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>wellformed f1 (supdate x v s1) h1 s3 h3
  (norm v)</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span>substore s3 s2</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk68" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk68"><span class="nb">unfold</span> wellformed <span class="kr">in</span> IHforward1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v s1) h1 s3 h3 (norm v) -&gt;
substore (supdate x v s1) s3</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span>substore s3 s2</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v s1) h1 s3 h3 x0</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk69" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk69"><span class="nb">unfold</span> replace_ret <span class="kr">in</span> Hrr; <span class="nb">destruct</span> Hrr <span class="kr">as</span> [? [? Hf1]]; <span class="nb">rewrite</span> supdate_same <span class="kr">in</span> H1; inj H1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v s1) h1 s3 h3 (norm v) -&gt;
substore (supdate x v s1) s3</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span>substore s3 s2</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hf1</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v s1) h1 s3 h3 (norm v)</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk6a" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk6a"><span class="nb">specialize</span> (IHforward1 Hf1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span>substore s3 s2</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hf1</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v s1) h1 s3 h3 (norm v)</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk6b" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk6b"><span class="nb">assert</span> (substore s1 (supdate x v s1)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span>substore s3 s2</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hf1</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v s1) h1 s3 h3 (norm v)</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 (supdate x v s1)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="FlowShallow-v-chk6c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span>substore s3 s2</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hf1</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v s1) h1 s3 h3 (norm v)</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>substore s1 (supdate x v s1)</span></span></span><br></div><label class="goal-separator" for="FlowShallow-v-chk6c"><hr></label><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk6d" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk6d"><span class="nb">apply</span> substore_extension; ok.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span>substore s3 s2</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hf1</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v s1) h1 s3 h3 (norm v)</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>substore s1 (supdate x v s1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s1 s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk6e" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk6e"><span class="nb">apply</span> substore_trans <span class="kr">with</span> (s2 := supdate x v s1); ok.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHforward1</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>IHforward2</var><span class="hyp-type"><b>: </b><span>substore s3 s2</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>s1 x = None</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hf1</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v s1) h1 s3 h3 (norm v)</span></span></span><br><span><var>Hf2</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 s2 h2 r</span></span></span><br><span><var>Hret</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>substore s1 (supdate x v s1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore (supdate x v s1) s2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> substore_trans <span class="kr">with</span> (s2 := s3); ok.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* {ens emp} e {\phi}, </span>
<span class="c">SH = { (check, s1, h1, R1)   |  [check, S, h] ~~&gt;m [check, s1, h2, R1] |= \phi }, and </span>
<span class="c">[S, h, e] -----&gt; [S2, h2, R2], R2!=\bot, </span>
<span class="c">such that: </span>
<span class="c">\exists (check, s3, h3, R3) \in SH, s3 \subset s2, h3 \subset h2, R2=R1 *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk6f" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk6f"><span class="kn">Theorem</span> <span class="nf">soundness</span> :
  <span class="kr">forall</span> <span class="nv">se1</span> <span class="nv">he1</span> <span class="nv">e</span> <span class="nv">se2</span> <span class="nv">he2</span> <span class="nv">re</span> (**) <span class="nv">f</span> <span class="nv">ss1</span> <span class="nv">hs1</span> <span class="nv">ss2</span> <span class="nv">hs2</span> <span class="nv">rs</span>,
    bigstep se1 he1 e se2 he2 re -&gt;
    substore se1 ss1 -&gt;
    <span class="c">(* he1 = hs1 -&gt; *)</span>
    forward e f -&gt;
    f ss1 hs1 ss2 hs2 rs -&gt;
    substore se2 ss2
    <span class="c">(* /\ he2 = hs2 *)</span>
    /\ compatible rs re.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">se1</span> : store) (<span class="nv">he1</span> : heap) (<span class="nv">e</span> : expr)
  (<span class="nv">se2</span> : store) (<span class="nv">he2</span> : heap) (<span class="nv">re</span> : eresult) (<span class="nv">f</span> : flow)
  (<span class="nv">ss1</span> : Common.store Z) (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store)
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
<span class="kp">eval</span>[ se1, he1, e]=&gt; [se2, he2, re] -&gt;
substore se1 ss1 -&gt;
forward e f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore se2 ss2 /\ compatible rs re</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk70" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk70"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">se1</span> : store) (<span class="nv">he1</span> : heap) (<span class="nv">e</span> : expr)
  (<span class="nv">se2</span> : store) (<span class="nv">he2</span> : heap) (<span class="nv">re</span> : eresult) (<span class="nv">f</span> : flow)
  (<span class="nv">ss1</span> : Common.store Z) (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store)
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
<span class="kp">eval</span>[ se1, he1, e]=&gt; [se2, he2, re] -&gt;
substore se1 ss1 -&gt;
forward e f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore se2 ss2 /\ compatible rs re</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk71" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk71"><span class="nb">intros</span> se1 he1 e se2 he2 re
            f ss1 hs1 ss2 hs2 rs
            Hb.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>se1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>he1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>se2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>he2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>re</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hb</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ se1, he1, e]=&gt; [se2, he2, re]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore se1 ss1 -&gt;
forward e f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore se2 ss2 /\ compatible rs re</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk72" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk72"><span class="nb">revert</span> f ss1 hs1 ss2 hs2 rs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>se1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>he1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>e</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>se2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>he2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>re</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ se1, he1, e]=&gt; [se2, he2, re]</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z) (<span class="nv">hs1</span> : heap)
  (<span class="nv">ss2</span> : store) (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore se1 ss1 -&gt;
forward e f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore se2 ss2 /\ compatible rs re</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk73" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk73"><span class="nb">induction</span> Hb;
    <span class="nb">intros</span> f ss1 hs1 ss2 hs2 rs;
    <span class="nb">intros</span> Hsub Hf Hs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s x</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>Hf</var><span class="hyp-type"><b>: </b><span>forward (pvar x) f</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>f ss1 hs1 ss2 hs2 rs</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ compatible rs (enorm v)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="FlowShallow-v-chk74" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>Hf</var><span class="hyp-type"><b>: </b><span>forward (pconst x) f</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>f ss1 hs1 ss2 hs2 rs</span></span></span><br></div><label class="goal-separator" for="FlowShallow-v-chk74"><hr></label><div class="goal-conclusion">substore s ss2 /\ compatible rs (enorm x)</div></blockquote><input class="alectryon-extra-goal-toggle" id="FlowShallow-v-chk75" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore s ss1 -&gt;
forward e1 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s1 ss2 /\ compatible rs (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>Hf</var><span class="hyp-type"><b>: </b><span>forward (plet x e1 e2) f</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>f ss1 hs1 ss2 hs2 rs</span></span></span><br></div><label class="goal-separator" for="FlowShallow-v-chk75"><hr></label><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk76" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk76">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s x</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>Hf</var><span class="hyp-type"><b>: </b><span>forward (pvar x) f</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>f ss1 hs1 ss2 hs2 rs</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ compatible rs (enorm v)</div></blockquote></div></div></small></span><span class="alectryon-wsp"> <span class="c">(* var. the proof comes down to the fact that both spec and program read</span>
<span class="c">          s(x) and leave the heap unchanged. *)</span>
</span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk77" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk77">inv Hf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s x</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>ens
  (<span class="kr">fun</span> (<span class="nv">res</span> : Z) (<span class="nv">s</span> : Common.store Z) (<span class="nv">h</span> : heap)
   =&gt; s x = Some v0 /\ res = v0 /\ emp s h) ss1
  hs1 ss2 hs2 rs</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ compatible rs (enorm v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk78" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk78"><span class="nb">unfold</span> ens <span class="kr">in</span> Hs; destr Hs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s x</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>ss1 = ss2</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>rs = norm H2</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>hs2 = hunion hs1 H3</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H3</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>ss1 x = Some v0</span></span></span><br><span><var>H7</var><span class="hyp-type"><b>: </b><span>H2 = v0</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>emp ss1 H3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ compatible rs (enorm v)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk79" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk79"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s x</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss2</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H3</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>ss2 x = Some v0</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>emp ss2 H3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ compatible (norm v0) (enorm v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk7a" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk7a"><span class="nb">unfold</span> emp <span class="kr">in</span> H9.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s x</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss2</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H3</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>ss2 x = Some v0</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>H3 = hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ compatible (norm v0) (enorm v)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk7b" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk7b"><span class="nb">unfold</span> compatible.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s x</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss2</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H3</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>ss2 x = Some v0</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>H3 = hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ v0 = v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk7c" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk7c">heap.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s x</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss2</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H3</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>ss2 x = Some v0</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>H3 = hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v0 = v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk7d" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk7d"><span class="nb">unfold</span> substore <span class="kr">in</span> Hsub.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Some v = s x</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Z) (<span class="nv">x</span> : ident),
s x = Some v -&gt; ss2 x = Some v</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H3</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>ss2 x = Some v0</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>H3 = hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v0 = v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk7e" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk7e"><span class="nb">symmetry in</span> H.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>s x = Some v</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">v</span> : Z) (<span class="nv">x</span> : ident),
s x = Some v -&gt; ss2 x = Some v</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H3</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>ss2 x = Some v0</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>H3 = hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v0 = v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk7f" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk7f"><span class="nb">specialize</span> (Hsub v x H).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span> -&gt; option Z</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>s x = Some v</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>ss2 x = Some v</span></span></span><br><span><var>v0</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H3</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>ss2 x = Some v0</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>H3 = hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">v0 = v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">congruence</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk80" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk80">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>Hf</var><span class="hyp-type"><b>: </b><span>forward (pconst x) f</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>f ss1 hs1 ss2 hs2 rs</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ compatible rs (enorm x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk81" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk81">inv Hf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = x) //\\ emp) ss1 hs1
  ss2 hs2 rs</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ compatible rs (enorm x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk82" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk82"><span class="nb">unfold</span> ens <span class="kr">in</span> Hs; destr Hs; <span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H2</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>((H1 = x) //\\ emp) ss2 H2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ compatible (norm H1) (enorm x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk83" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk83"><span class="nb">unfold</span> compatible.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H2</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>((H1 = x) //\\ emp) ss2 H2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ H1 = x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk84" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk84"><span class="nb">unfold</span> pureconj <span class="kr">in</span> H6.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss2</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>hdisjoint hs1 H2</span></span></span><br><span><var>H6</var><span class="hyp-type"><b>: </b><span>H1 = x /\ emp ss2 H2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s ss2 /\ H1 = x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intuition</span> <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk85" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk85">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore s ss1 -&gt;
forward e1 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s1 ss2 /\ compatible rs (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>Hf</var><span class="hyp-type"><b>: </b><span>forward (plet x e1 e2) f</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>f ss1 hs1 ss2 hs2 rs</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    <span class="c">(* we have an IH for each subexpr *)</span>
    <span class="c">(* v is the intermediate result of evaluating e1 *)</span>
    <span class="c">(* r is the final result *)</span>
    <span class="c">(* invp Hf [H2 H4]. *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk86" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk86">inv Hf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore s ss1 -&gt;
forward e1 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s1 ss2 /\ compatible rs (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>fexists x (replace_ret x f1;; f2) ss1 hs1 ss2 hs2
  rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    <span class="c">(* invp Hf [ | |Hff1 Hff2]. *)</span>
    <span class="c">(* inversion Hf as [ Hy Hz |  |Hff1 Hff2 Hz]. subst; clear Hf. *)</span>
    <span class="c">(* the spec is of the form ex x. f1[x/r];f2 *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk87" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk87"><span class="nb">unfold</span> fexists <span class="kr">in</span> Hs.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore s ss1 -&gt;
forward e1 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s1 ss2 /\ compatible rs (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hs</var><span class="hyp-type"><b>: </b><span>ss1 x = None /\
(<span class="kr">exists</span> <span class="nv">v</span> : Z,
   (replace_ret x f1;; f2) 
     (supdate x v ss1) hs1 ss2 hs2 rs)</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk88" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk88"><span class="nb">destruct</span> Hs <span class="kr">as</span> [Hnotin [v1 Hseq]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore s ss1 -&gt;
forward e1 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s1 ss2 /\ compatible rs (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>Hseq</var><span class="hyp-type"><b>: </b><span>(replace_ret x f1;; f2) (supdate x v1 ss1) hs1
  ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    <span class="c">(* see how it evaluates *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk89" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk89"><span class="nb">unfold</span> seq <span class="kr">in</span> Hseq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore s ss1 -&gt;
forward e1 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s1 ss2 /\ compatible rs (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>Hseq</var><span class="hyp-type"><b>: </b><span><span class="kr">exists</span> (<span class="nv">s3</span> : store) (<span class="nv">h3</span> : heap) 
(<span class="nv">r1</span> : result),
  replace_ret x f1 (supdate x v1 ss1) hs1 s3 h3
    r1 /\ f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk8a" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk8a"><span class="nb">destruct</span> Hseq <span class="kr">as</span> [s3 [h3 [? [Hrr ?]]]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore s ss1 -&gt;
forward e1 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s1 ss2 /\ compatible rs (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hrr</var><span class="hyp-type"><b>: </b><span>replace_ret x f1 (supdate x v1 ss1) hs1 s3 h3 x0</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk8b" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk8b"><span class="nb">unfold</span> replace_ret <span class="kr">in</span> Hrr; <span class="nb">destruct</span> Hrr <span class="kr">as</span> [H10 [H9 H13]].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore s ss1 -&gt;
forward e1 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s1 ss2 /\ compatible rs (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">

    <span class="c">(* OLD NOW FIXED now the problem is the IH requires the eval of e1 to take place in the initial stack. but due to the existential adding something to the stack, the evaluation takes place in an extended stack, so we can&#39;t apply the IH for e1 *)</span>

    <span class="c">(* OLD NOW FIXED the problem is the positioning of the existential has changed. in the program, it&#39;s in the e2 initial stack. in the spec, it&#39;s right at the front, in the e1 initial stack, for f1 to assign its ret value to. so somehow need to generalise it, using compiler simulation techniques? there should be an initial relation too, so the spec is allowed to execute in an extended stack. so there&#39;s a sim rel between configurations *)</span>

    <span class="c">(* try to meet in the middle *)</span>
    <span class="c">(* apply IHHb2. *)</span>
    <span class="c">(* with (f:=f2) (ss2:=s2) (ss1:=s2) (hs1:=hs2). *)</span>
    <span class="c">(* easy. *)</span>
    <span class="c">(* specialize (IHHb1 f1 (supdate x v s) hs1 s1 h1 (norm v) ). *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk8c" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk8c"><span class="nb">pose proof</span> (substore_extension_trans _ s ss1 v1 x Hsub Hnotin) <span class="kr">as</span> Hha.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore s ss1 -&gt;
forward e1 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s1 ss2 /\ compatible rs (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk8d" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk8d"><span class="nb">specialize</span> (IHHb1 f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10) Hha H2 H13).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IHHb1</var><span class="hyp-type"><b>: </b><span>substore s1 s3 /\
compatible (norm H10) (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk8e" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk8e"><span class="nb">destruct</span> IHHb1 <span class="kr">as</span> [IH1 IH2].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>compatible (norm H10) (enorm v)</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">f</span> : flow) (<span class="nv">ss1</span> : Common.store Z)
  (<span class="nv">hs1</span> : heap) (<span class="nv">ss2</span> : store) 
  (<span class="nv">hs2</span> : heap) (<span class="nv">rs</span> : result),
substore (supdate x v s1) ss1 -&gt;
forward e2 f -&gt;
f ss1 hs1 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1, f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    <span class="c">(* we know that evaluation of e1 preserves substore *)</span>

    <span class="c">(* now try to use IH2 *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk8f" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk8f"><span class="nb">specialize</span> (IHHb2 f2 s3 h3 ss2 hs2 rs).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>compatible (norm H10) (enorm v)</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore s2 ss2 /\ compatible rs r</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk90" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk90"><span class="nb">apply</span> IHHb2; <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>compatible (norm H10) (enorm v)</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">substore (supdate x v s1) s3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk91" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk91"><span class="nb">apply</span> (substore_extension_left _ s1 s3 v x IH1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>compatible (norm H10) (enorm v)</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s3 x = Some v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk92" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk92"><span class="nb">unfold</span> compatible <span class="kr">in</span> IH2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s3 x = Some v</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk93" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk93"><span class="nb">rewrite</span> &lt;- IH2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s3 x = Some H10</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk94" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk94"><span class="nb">rewrite</span> H9.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = supdate x v1 ss1 x</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s3 x = supdate x v1 ss1 x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk95" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk95"><span class="nb">rewrite</span> supdate_same <span class="kr">in</span> H9.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = Some v1</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s3 x = supdate x v1 ss1 x</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk96" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk96"><span class="nb">rewrite</span> supdate_same.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = Some v1</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s3 x = Some v1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    <span class="c">(* need to know substore (supdate x v1 ss1) H6 is preserved by all spec/f eval *)</span>
    <span class="c">(* but how to know that, as we can give any f *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk97" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk97"><span class="nb">pose proof</span> (forward_wellformed _ _ (supdate x v1 ss1) hs1 s3 h3 (norm H10) H2) <span class="kr">as</span> Hf1wf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = Some v1</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br><span><var>Hf1wf</var><span class="hyp-type"><b>: </b><span>wellformed f1 (supdate x v1 ss1) hs1 s3 h3
  (norm H10)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s3 x = Some v1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk98" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk98"><span class="nb">unfold</span> wellformed <span class="kr">in</span> Hf1wf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = Some v1</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br><span><var>Hf1wf</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10) -&gt;
substore (supdate x v1 ss1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s3 x = Some v1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
    <span class="c">(* assert (Hpreserve : substore (supdate x v1 ss1) s3). admit. *)</span>
    <span class="c">(* apply Hf1wf. *)</span>
    <span class="c">(* unfold substore in Hpreserve. *)</span>
    <span class="c">(* apply Hpreserve. *)</span>
</span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk99" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk99"><span class="nb">apply</span> Hf1wf.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = Some v1</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br><span><var>Hf1wf</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10) -&gt;
substore (supdate x v1 ss1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="FlowShallow-v-chk9a" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = Some v1</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br><span><var>Hf1wf</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10) -&gt;
substore (supdate x v1 ss1) s3</span></span></span><br></div><label class="goal-separator" for="FlowShallow-v-chk9a"><hr></label><div class="goal-conclusion">supdate x v1 ss1 x = Some v1</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk9b" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk9b">ok.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = Some v1</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br><span><var>Hf1wf</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10) -&gt;
substore (supdate x v1 ss1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">supdate x v1 ss1 x = Some v1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk9c" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk9c"><span class="nb">rewrite</span> supdate_same.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>x</var><span class="hyp-type"><b>: </b><span><span class="kn">ident</span></span></span></span><br><span><var>e1, e2</var><span class="hyp-type"><b>: </b><span>expr</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h, h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2, s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>Hb1</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s, h, e1]=&gt; [s1, h1, enorm v]</span></span></span><br><span><var>Hb2</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ supdate x v s1, h1, e2]=&gt; [s2, h2, r]</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H10</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>IH1</var><span class="hyp-type"><b>: </b><span>substore s1 s3</span></span></span><br><span><var>IH2</var><span class="hyp-type"><b>: </b><span>H10 = v</span></span></span><br><span><var>ss2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>hs2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>rs</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f2</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>IHHb2</var><span class="hyp-type"><b>: </b><span>substore (supdate x v s1) s3 -&gt;
forward e2 f2 -&gt;
f2 s3 h3 ss2 hs2 rs -&gt;
substore s2 ss2 /\ compatible rs r</span></span></span><br><span><var>ss1</var><span class="hyp-type"><b>: </b><span>Common.store Z</span></span></span><br><span><var>hs1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>Hsub</var><span class="hyp-type"><b>: </b><span>substore s ss1</span></span></span><br><span><var>f1</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>Hnotin</var><span class="hyp-type"><b>: </b><span>ss1 x = None</span></span></span><br><span><var>v1</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>Some H10 = Some v1</span></span></span><br><span><var>H13</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10)</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f2 s3 h3 ss2 hs2 rs</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>forward e1 f1</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>forward e2 f2</span></span></span><br><span><var>Hha</var><span class="hyp-type"><b>: </b><span>substore s (supdate x v1 ss1)</span></span></span><br><span><var>Hf1wf</var><span class="hyp-type"><b>: </b><span>f1 (supdate x v1 ss1) hs1 s3 h3 (norm H10) -&gt;
substore (supdate x v1 ss1) s3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Some v1 = Some v1</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">reflexivity</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
<span class="c">(* https://xavierleroy.org/courses/EUTypes-2019/slides.pdf *)</span>

</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><div class="doc">
<a id="lab2"></a><h1 class="section">Semantic flows</h1>
</div><pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">triple</span> (<span class="nv">pre</span>:flow) (<span class="nv">e</span>:expr) (<span class="nv">spec</span>:flow) : <span class="kt">Prop</span> :=
  <span class="kr">forall</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">r</span> <span class="nv">sr</span> <span class="nv">s0</span> <span class="nv">h0</span> <span class="nv">r0</span> <span class="nv">s3</span> <span class="nv">h3</span>,
      pre s0 h0 s1 h1 r0 -&gt;
      bigstep s1 h1 e s2 h2 r -&gt;
      spec s0 h0 s3 h3 sr -&gt;
      compatible sr r /\ h2 = h3.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">triple_tabula_rasa</span> (<span class="nv">e</span>:expr) (<span class="nv">spec</span>:flow) : <span class="kt">Prop</span> :=
  triple empty e spec.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  
  <span class="c">(*</span>
<span class="c">    {pre} e {spec}</span>
<span class="c">    s,h |= pre</span>
<span class="c">    s,h,e -&gt; s1,h1,v</span>
<span class="c">    -------------------</span>
<span class="c">    s,h,e ~&gt; s1,h1,v |= spec</span>
<span class="c">  *)</span>
<span class="c">(* . *)</span>

</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk9d" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk9d"><span class="kn">Lemma</span> <span class="nf">flow_det</span> : <span class="kr">forall</span> <span class="nv">s</span> <span class="nv">h</span> <span class="nv">s1</span> <span class="nv">h1</span> <span class="nv">r1</span> <span class="nv">s2</span> <span class="nv">h2</span> <span class="nv">r2</span> (<span class="nv">f</span>:flow),
    f s h s1 h1 r1 -&gt;
    f s h s2 h2 r2 -&gt;
    s1 = s2 /\ h1 = h2 /\ r1 = r2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">s</span> : store) (<span class="nv">h</span> : heap) (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">r1</span> : result) (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) (<span class="nv">r2</span> : result)
  (<span class="nv">f</span> : flow),
f s h s1 h1 r1 -&gt;
f s h s2 h2 r2 -&gt; s1 = s2 /\ h1 = h2 /\ r1 = r2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk9e" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk9e"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">s</span> : store) (<span class="nv">h</span> : heap) (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap)
  (<span class="nv">r1</span> : result) (<span class="nv">s2</span> : store) (<span class="nv">h2</span> : heap) (<span class="nv">r2</span> : result)
  (<span class="nv">f</span> : flow),
f s h s1 h1 r1 -&gt;
f s h s2 h2 r2 -&gt; s1 = s2 /\ h1 = h2 /\ r1 = r2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chk9f" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chk9f"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>s</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>f s h s1 h1 r1</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>f s h s2 h2 r2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s1 = s2 /\ h1 = h2 /\ r1 = r2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* destruct H. *)</span>
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">admit</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Admitted</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka0" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka0"><span class="kn">Lemma</span> <span class="nf">fw_const1</span> : <span class="kr">forall</span> <span class="nv">p</span> <span class="nv">n</span>,
  triple p (pconst n) (p ;; ens (<span class="kr">fun</span> <span class="nv">res</span> =&gt; (res = n) //\\ emp)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">p</span> : flow) (<span class="nv">n</span> : val),
triple p (pconst n)
  (p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka1" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">p</span> : flow) (<span class="nv">n</span> : val),
triple p (pconst n)
  (p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka2" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka2"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">triple p (pconst n)
  (p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka3" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka3"><span class="nb">unfold</span> triple.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">s1</span> : store) (<span class="nv">h1</span> : heap) (<span class="nv">s2</span> : store)
  (<span class="nv">h2</span> : heap) (<span class="nv">r</span> : eresult) (<span class="nv">sr</span> : result) (<span class="nv">s0</span> : store)
  (<span class="nv">h0</span> : heap) (<span class="nv">r0</span> : result) (<span class="nv">s3</span> : store) (<span class="nv">h3</span> : heap),
p s0 h0 s1 h1 r0 -&gt;
<span class="kp">eval</span>[ s1, h1, pconst n]=&gt; [s2, h2, r] -&gt;
(p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp)) s0 h0 s3
  h3 sr -&gt; compatible sr r /\ h2 = h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka4" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka4"><span class="nb">intros</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>eresult</span></span></span><br><span><var>sr</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s1 h1 r0</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span><span class="kp">eval</span>[ s1, h1, pconst n]=&gt; [s2, h2, r]</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>(p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp)) s0
  h0 s3 h3 sr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">compatible sr r /\ h2 = h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka5" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka5"><span class="kr">match goal with</span> | H : bigstep _ _ _ _ _ _ |- _ =&gt; inv H <span class="kr">end</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sr</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>(p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp)) s0
  h0 s3 h3 sr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">compatible sr (enorm n) /\ h2 = h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka6" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka6"><span class="nb">split</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sr</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>(p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp)) s0
  h0 s3 h3 sr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">compatible sr (enorm n)</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="FlowShallow-v-chka7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sr</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>(p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp)) s0
  h0 s3 h3 sr</span></span></span><br></div><label class="goal-separator" for="FlowShallow-v-chka7"><hr></label><div class="goal-conclusion">h2 = h3</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka8" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sr</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>(p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp)) s0
  h0 s3 h3 sr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">compatible sr (enorm n)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chka9" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chka9">fstep.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sr</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 H0 H1 H2</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp) H0 H1 s3
  h3 sr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">compatible sr (enorm n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkaa" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkaa">fstep.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 s3 H1 H2</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H7</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>hdisjoint H1 H7</span></span></span><br><span><var>H11</var><span class="hyp-type"><b>: </b><span>((H5 = n) //\\ emp) s3 H7</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">compatible (norm H5) (enorm n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkab" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkab">fstep.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 s3 H1 H2</span></span></span><br><span><var>H7</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>hdisjoint H1 H7</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>emp s3 H7</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">compatible (norm n) (enorm n)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkac" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkac"><span class="nb">unfold</span> compatible.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 s3 H1 H2</span></span></span><br><span><var>H7</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>hdisjoint H1 H7</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>emp s3 H7</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">n = n</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input">ok.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkad" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkad">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sr</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>(p;; ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp)) s0
  h0 s3 h3 sr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h2 = h3</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkae" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkae">fstep.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>sr</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 H0 H1 H2</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>ens (<span class="kr">fun</span> <span class="nv">res</span> : Z =&gt; (res = n) //\\ emp) H0 H1 s3
  h3 sr</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h2 = h3</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkaf" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkaf">fstep.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 s3 H1 H2</span></span></span><br><span><var>H5</var><span class="hyp-type"><b>: </b><span>Z</span></span></span><br><span><var>H7</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>hdisjoint H1 H7</span></span></span><br><span><var>H11</var><span class="hyp-type"><b>: </b><span>((H5 = n) //\\ emp) s3 H7</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h2 = hunion H1 H7</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkb0" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkb0">fstep.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 s3 H1 H2</span></span></span><br><span><var>H7</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>hdisjoint H1 H7</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>emp s3 H7</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">h2 = hunion H1 H7</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkb1" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkb1"><span class="nb">specialize</span> (flow_det s0 h0 s2 h2 r0 s3 H1 H2 p H H3).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 s3 H1 H2</span></span></span><br><span><var>H7</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>hdisjoint H1 H7</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>emp s3 H7</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s2 = s3 /\ h2 = H1 /\ r0 = H2 -&gt; h2 = hunion H1 H7</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkb2" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkb2">destr flow_det.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 s3 H1 H2</span></span></span><br><span><var>H7</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>hdisjoint H1 H7</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>emp s3 H7</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s2 = s3 /\ h2 = H1 /\ r0 = H2 -&gt; h2 = hunion H1 H7</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkb3" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkb3"><span class="nb">unfold</span> emp <span class="kr">in</span> H4.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 s3 H1 H2</span></span></span><br><span><var>H7</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>hdisjoint H1 H7</span></span></span><br><span><var>H4</var><span class="hyp-type"><b>: </b><span>H7 = hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s2 = s3 /\ h2 = H1 /\ r0 = H2 -&gt; h2 = hunion H1 H7</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="FlowShallow-v-chkb4" style="display: none" type="checkbox"><label class="alectryon-input" for="FlowShallow-v-chkb4"><span class="nb">subst</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>p</var><span class="hyp-type"><b>: </b><span>flow</span></span></span><br><span><var>n</var><span class="hyp-type"><b>: </b><span>val</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>s0</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>h0</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>s3</var><span class="hyp-type"><b>: </b><span>store</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>p s0 h0 s2 h2 r0</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>heap</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>result</span></span></span><br><span><var>H3</var><span class="hyp-type"><b>: </b><span>p s0 h0 s3 H1 H2</span></span></span><br><span><var>H9</var><span class="hyp-type"><b>: </b><span>hdisjoint H1 hempty</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">s2 = s3 /\ h2 = H1 /\ r0 = H2 -&gt; h2 = hunion H1 hempty</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input">heap.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  <span class="c">(* TODO substore then needs simulation relation *)</span>
</span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Abort</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp"><span class="c">(* Qed. *)</span></span></pre></article></body></html>